{"remainingRequest":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\babel-loader\\lib\\index.js!F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\src\\views\\contract\\blackList\\importdialog.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\src\\views\\contract\\blackList\\importdialog.vue","mtime":1618367977421},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { checkpassdata, checkfaildata, submitpassdata as _submitpassdata } from \"@/api/contract/blackList/blackwhitelist\";\nimport website from \"@/config/website\";\nimport { getToken } from '@/util/auth';\nexport default {\n  name: \"import-dialog\",\n  props: {\n    showDialog: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data: function data() {\n    return {\n      loading: false,\n      activeStep: 1,\n      fileList: [],\n      headerObj: {\n        \"Authorization\": \"Basic \".concat(Base64.encode(\"\".concat(website.clientId, \":\").concat(website.clientSecret))),\n        \"Blade-Auth\": 'Bearer ' + getToken()\n      },\n      //附件上传请求头参数\n      passPage: {\n        pageSize: 10,\n        currentPage: 1,\n        total: 0\n      },\n      failPage: {\n        pageSize: 10,\n        currentPage: 1,\n        total: 0\n      },\n      dataSuccess: [{\n        exchange: '张三',\n        dataCode: '利率债_金融债_IBABS',\n        type: 'XHCJ001',\n        custName: '中央国债登记结算有限责任公司',\n        remark: '行情数据'\n      }],\n      dataFail: [{\n        exchange: '张三',\n        dataCode: '利率债_金融债_IBABS',\n        type: 'XHCJ001',\n        custName: '中央国债登记结算有限责任公司',\n        remark: '行情数据',\n        errorTip: '字符超过限制长度，第5行D列'\n      }],\n      optionSuccess: {\n        calcHeight: 100,\n        searchShow: true,\n        searchMenuSpan: 6,\n        border: true,\n        index: false,\n        viewBtn: false,\n        addBtn: false,\n        refreshBtn: false,\n        columnBtn: false,\n        menu: false,\n        column: [{\n          label: '交易所',\n          prop: 'exchange'\n        }, {\n          label: '数据编码',\n          prop: 'dataCode'\n        }, {\n          label: '类型',\n          prop: 'type'\n        }, {\n          label: '客户名称',\n          prop: 'custName'\n        }, {\n          label: '备注',\n          prop: 'remark'\n        }]\n      },\n      optionFail: {\n        calcHeight: 210,\n        searchShow: true,\n        searchMenuSpan: 6,\n        border: true,\n        index: false,\n        viewBtn: false,\n        addBtn: false,\n        refreshBtn: false,\n        columnBtn: false,\n        menu: false,\n        column: [{\n          label: '交易所',\n          prop: 'exchange'\n        }, {\n          label: '数据编码',\n          prop: 'dataCode'\n        }, {\n          label: '类型',\n          prop: 'type',\n          dicUrl: this.getDicValue(this.CONSTANT.BLACKLIST_TYPE),\n          props: {\n            label: \"dictValue\",\n            value: \"dictKey\"\n          }\n        }, {\n          label: '客户名称',\n          prop: 'custName'\n        }, {\n          label: '备注',\n          prop: 'remark'\n        }, {\n          label: '错误提示',\n          prop: 'errorMsg'\n        }]\n      },\n      passRedisKey: \"\",\n      failRedisKey: \"\",\n      submitPassNum: 0,\n      fileMaxSize: 2 * 1024 * 1024\n    };\n  },\n  mounted: function mounted() {},\n  methods: {\n    checkFileSize: function checkFileSize(file) {\n      if (file && file.size > this.fileMaxSize) {\n        this.$message.warning('文件后缀名必须为xls或xlsx（即Excel格式），文件大小不得大于2M');\n        this.fileList = [];\n        return false;\n      }\n\n      return true;\n    },\n    handleExceed: function handleExceed(files, fileList) {\n      this.$message.warning(\"\\u5F53\\u524D\\u9650\\u5236\\u9009\\u62E9 1 \\u4E2A\\u6587\\u4EF6\\uFF0C\\u672C\\u6B21\\u5171\\u9009\\u62E9\\u4E86 \".concat(files.length + fileList.length, \" \\u4E2A\\u6587\\u4EF6\\uFF1B\\u6587\\u4EF6\\u540E\\u7F00\\u540D\\u5FC5\\u987B\\u4E3Axls\\u6216xlsx\\uFF08\\u5373Excel\\u683C\\u5F0F\\uFF09\\uFF0C\\u6587\\u4EF6\\u5927\\u5C0F\\u4E0D\\u5F97\\u5927\\u4E8E2M\"));\n    },\n    exportCheckfaildata: function exportCheckfaildata() {\n      window.open(\"/api/cnfic-contract-manage/blackwhitelist/export-checkfaildata?\".concat(website.tokenHeader, \"=\").concat(getToken(), \"&failRedisKey=\").concat(this.failRedisKey));\n    },\n    exportTemplate: function exportTemplate() {\n      window.open(\"/api/cnfic-contract-manage/blackwhitelist/export-template?\".concat(website.tokenHeader, \"=\").concat(getToken()));\n    },\n    closeDialog: function closeDialog() {\n      this.$emit(\"close\");\n    },\n    handleChange: function handleChange(response, file, fileList) {\n      if (response) {\n        this.passRedisKey = response.data.passRedisKey;\n        this.failRedisKey = response.data.failRedisKey;\n      }\n    },\n    onLoadSuccess: function onLoadSuccess() {\n      var _this = this;\n\n      this.loading = true;\n      var filter = {\n        \"passRedisKey\": this.passRedisKey\n      };\n      checkpassdata(this.passPage.currentPage, this.passPage.pageSize, filter).then(function (res) {\n        var data = res.data.data;\n        _this.passPage.total = data.total;\n        _this.dataSuccess = data.records;\n        _this.loading = false;\n      });\n    },\n    handlePassSizeChange: function handlePassSizeChange(size) {\n      this.passPage.pageSize = size;\n      this.onLoadSuccess();\n    },\n    handlePassCurrentChange: function handlePassCurrentChange(page) {\n      this.passPage.currentPage = page;\n      this.onLoadSuccess();\n    },\n    onLoadFail: function onLoadFail() {\n      var _this2 = this;\n\n      this.loading = true;\n      var filter = {\n        \"failRedisKey\": this.failRedisKey\n      };\n      checkfaildata(this.failPage.currentPage, this.failPage.pageSize, filter).then(function (res) {\n        var data = res.data.data;\n        _this2.failPage.total = data.total;\n        _this2.dataFail = data.records;\n        _this2.loading = false;\n      });\n    },\n    handleFailSizeChange: function handleFailSizeChange(size) {\n      this.failPage.pageSize = size;\n      this.onLoadFail();\n    },\n    handleFailCurrentChange: function handleFailCurrentChange(page) {\n      this.failPage.currentPage = page;\n      this.onLoadFail();\n    },\n    submitpassdata: function submitpassdata() {\n      var _this3 = this;\n\n      this.loading = true;\n      var filter = {\n        \"passRedisKey\": this.passRedisKey\n      };\n\n      _submitpassdata(filter).then(function (res) {\n        _this3.submitPassNum = res.data;\n      }, function (error) {\n        window.console.log(error);\n      });\n    },\n    next: function next(step) {\n      this.activeStep = step;\n\n      if (step == 3 && this.passPage.total != 0) {\n        this.submitpassdata();\n      }\n    }\n  }\n};",{"version":3,"sources":["importdialog.vue"],"names":[],"mappings":"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","sourcesContent":["<!--导入的弹窗-->\r\n<template>\r\n    <el-dialog\r\n    title=\"批量导入\"\r\n    :visible.sync=\"showDialog\"\r\n    @close=\"closeDialog\"\r\n    >\r\n    <basic-container>\r\n        <el-steps :active=\"activeStep\" align-center>\r\n            <el-step title=\"上传文件\"></el-step>\r\n            <el-step title=\"数据校验\"></el-step>\r\n            <el-step title=\"数据入库\"></el-step>\r\n        </el-steps>\r\n        <template>\r\n            <div class=\"el-import-step\" v-if=\"activeStep==1\">\r\n                <div class=\"el-import-step-download\">\r\n                    <div class=\"el-import-step-download-icon\">\r\n                        <i class=\"el-icon-download\"></i>\r\n                    </div>\r\n                    <div class=\"el-import-step-download-desc\">\r\n                        <div>导入模板文件下载</div>\r\n                        <div class=\"download-tip\">请按照数据模板的格式准备导入数据，模板中的表头名称不可更改，表头行不能删除</div>\r\n                        <div><el-link type=\"primary\" :underline=\"false\" @click=\"exportTemplate\">下载模板</el-link></div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"el-import-step-download\">\r\n                    <div class=\"el-import-step-download-icon\">\r\n                        <i class=\"el-icon-upload\"></i>\r\n                    </div>\r\n                    <div class=\"el-import-step-download-desc\">\r\n                        <div>上传填好的导入模板</div>\r\n                        <div class=\"download-tip\">文件后缀名必须为xls或xlsx（即Excel格式），文件大小不得大于2M</div>\r\n                        <el-upload\r\n                        multiple\r\n                        :limit=\"1\"\r\n                        accept=\".xls, .xlsx\"\r\n                        :headers=\"headerObj\"\r\n                        action=\"/api/cnfic-contract-manage/blackwhitelist/import-blackwhitelist\"\r\n                        :on-success=\"handleChange\"\r\n                        :before-upload=\"checkFileSize\"\r\n                        :on-exceed=\"handleExceed\"\r\n                        :file-list=\"fileList\">\r\n                        <el-link type=\"primary\" :underline=\"false\">上传文件</el-link>\r\n                        </el-upload>\r\n                    </div>\r\n                </div>\r\n                <div class=\"el-import-step-footer\">\r\n                    <el-button size=\"small\" type=\"primary\" @click=\"next(2)\">&nbsp;&nbsp;&nbsp;下一步&nbsp;&nbsp;&nbsp;</el-button>\r\n                    <el-button size=\"small\" @click=\"closeDialog\">&nbsp;&nbsp;&nbsp;取&nbsp;&nbsp;&nbsp;消&nbsp;&nbsp;&nbsp;</el-button>\r\n                </div>\r\n            </div>\r\n            <div class=\"el-import-step\" v-if=\"activeStep==2\">\r\n                <avue-crud\r\n                    :option=\"optionSuccess\"\r\n                    :table-loading=\"loading\"\r\n                    :page.sync=\"passPage\"\r\n                    :data=\"dataSuccess\"\r\n                    @on-load=\"onLoadSuccess\">\r\n                    <template slot=\"header\">\r\n                        <div class=\"el-import-list-header\">\r\n                            校验成功数据列表\r\n                            <el-link type=\"primary\" :underline=\"false\" size=\"small\">{{passPage.total}}条</el-link>\r\n                        </div>\r\n                    </template>\r\n                </avue-crud>\r\n                <div class=\"el-import-list-pagination\">\r\n                  <el-pagination\r\n                    background\r\n                    @size-change=\"handlePassSizeChange\"\r\n                    @current-change=\"handlePassCurrentChange\"\r\n                    :current-page=\"passPage.currentPage\"\r\n                    :page-size=\"passPage.pageSize\"\r\n                    layout=\"total, sizes, prev, pager, next, jumper\"\r\n                    :total=\"passPage.total\">\r\n                  </el-pagination>\r\n                </div>\r\n                <avue-crud\r\n                :option=\"optionFail\"\r\n                :table-loading=\"loading\"\r\n                :page.sync=\"failPage\"\r\n                :data=\"dataFail\"\r\n                @on-load=\"onLoadFail\">\r\n                <template slot=\"header\">\r\n                    <div class=\"el-import-list-header\">\r\n                        校验失败数据列表\r\n                        <el-link type=\"primary\" :underline=\"false\" size=\"small\">{{failPage.total}}条</el-link>\r\n                        <el-link type=\"primary\" :underline=\"false\" size=\"small\" @click=\"exportCheckfaildata\">下载失败数据列表</el-link>\r\n                    </div>\r\n                </template>\r\n                </avue-crud>\r\n                    <div class=\"el-import-list-pagination\">\r\n                        <el-pagination\r\n                            background\r\n                            @size-change=\"handleFailSizeChange\"\r\n                            @current-change=\"handleFailCurrentChange\"\r\n                            :current-page=\"failPage.currentPage\"\r\n                            :page-size=\"failPage.pageSize\"\r\n                            layout=\"total, sizes, prev, pager, next, jumper\"\r\n                            :total=\"failPage.total\">\r\n                        </el-pagination>\r\n                    </div>\r\n                <div class=\"el-import-step-footer\">\r\n                    <el-button size=\"small\" type=\"primary\" @click=\"next(1)\">返回重新上传</el-button>\r\n                    <el-button size=\"small\" type=\"primary\" @click=\"next(3)\">忽略异常数据导入</el-button>\r\n                    <el-button size=\"small\" @click=\"closeDialog\">&nbsp;&nbsp;&nbsp;取&nbsp;&nbsp;&nbsp;消&nbsp;&nbsp;&nbsp;</el-button>\r\n                </div>\r\n             </div>\r\n            <div class=\"el-import-step\" v-if=\"activeStep==3\">\r\n                <div class=\"el-import-step-three\">\r\n                    <div class=\"el-import-step-download-icon\"><i class=\"el-icon-success\"></i></div>\r\n                    <h3>数据导入成功</h3>\r\n                    <div class=\"download-tip\">导入数据{{submitPassNum}}条</div>\r\n                </div>\r\n                <div class=\"el-import-step-footer\">\r\n                    <el-button size=\"small\" type=\"primary\" @click=\"closeDialog\">&nbsp;&nbsp;&nbsp;完&nbsp;&nbsp;&nbsp;成&nbsp;&nbsp;&nbsp;</el-button>\r\n                </div>\r\n            </div>\r\n        </template>\r\n    </basic-container>\r\n    </el-dialog>\r\n</template>\r\n<script>\r\nimport {checkpassdata, checkfaildata, submitpassdata} from \"@/api/contract/blackList/blackwhitelist\";\r\nimport website from \"@/config/website\";\r\nimport { getToken } from '@/util/auth';\r\nexport default{\r\n    name:\"import-dialog\",\r\n    props:{\r\n        showDialog:{\r\n            type:Boolean,\r\n            default:false\r\n        }\r\n    },\r\n    data(){\r\n        return{\r\n            loading:false,\r\n            activeStep:1,\r\n            fileList:[],\r\n            headerObj:{\r\n                \"Authorization\":`Basic ${Base64.encode(`${website.clientId}:${website.clientSecret}`)}`,\r\n                \"Blade-Auth\":'Bearer ' + getToken()\r\n            },//附件上传请求头参数\r\n            passPage: {\r\n                pageSize: 10,\r\n                currentPage: 1,\r\n                total:0\r\n            },\r\n            failPage: {\r\n              pageSize: 10,\r\n              currentPage: 1,\r\n              total:0\r\n            },\r\n            dataSuccess:[{\r\n                exchange:'张三',\r\n                dataCode:'利率债_金融债_IBABS',\r\n                type:'XHCJ001',\r\n                custName:'中央国债登记结算有限责任公司',\r\n                remark:'行情数据'\r\n            }],\r\n            dataFail:[{\r\n                exchange:'张三',\r\n                dataCode:'利率债_金融债_IBABS',\r\n                type:'XHCJ001',\r\n                custName:'中央国债登记结算有限责任公司',\r\n                remark:'行情数据',\r\n                errorTip:'字符超过限制长度，第5行D列'\r\n            }],\r\n            optionSuccess:{\r\n                calcHeight: 100,\r\n                searchShow: true,\r\n                searchMenuSpan: 6,\r\n                border: true,\r\n                index: false,\r\n                viewBtn: false,\r\n                addBtn:false,\r\n                refreshBtn:false,\r\n                columnBtn:false,\r\n                menu:false,\r\n                column: [{\r\n                    label: '交易所',\r\n                    prop: 'exchange'\r\n                },\r\n                {\r\n                    label: '数据编码',\r\n                    prop: 'dataCode'\r\n                },\r\n                {\r\n                    label: '类型',\r\n                    prop: 'type'\r\n                },{\r\n                    label: '客户名称',\r\n                    prop: 'custName'\r\n                },\r\n                {\r\n                    label: '备注',\r\n                    prop: 'remark'\r\n                }]\r\n            },\r\n            optionFail:{\r\n                calcHeight: 210,\r\n                searchShow: true,\r\n                searchMenuSpan: 6,\r\n                border: true,\r\n                index: false,\r\n                viewBtn: false,\r\n                addBtn:false,\r\n                refreshBtn:false,\r\n                columnBtn:false,\r\n                menu:false,\r\n                column: [{\r\n                    label: '交易所',\r\n                    prop: 'exchange'\r\n                },\r\n                {\r\n                    label: '数据编码',\r\n                    prop: 'dataCode'\r\n                },\r\n                {\r\n                    label: '类型',\r\n                    prop: 'type',\r\n                    dicUrl: this.getDicValue(this.CONSTANT.BLACKLIST_TYPE),\r\n                    props: {\r\n                      label: \"dictValue\",\r\n                      value: \"dictKey\"\r\n                    },\r\n                },{\r\n                    label: '客户名称',\r\n                    prop: 'custName'\r\n                },\r\n                {\r\n                    label: '备注',\r\n                    prop: 'remark'\r\n                },\r\n                {\r\n                    label: '错误提示',\r\n                    prop: 'errorMsg',\r\n                }]\r\n            },\r\n            passRedisKey:\"\",\r\n            failRedisKey:\"\",\r\n            submitPassNum:0,\r\n            fileMaxSize:2*1024*1024,\r\n        }\r\n    },\r\n    mounted(){\r\n    },\r\n    methods:{\r\n      checkFileSize(file){\r\n        if (file && file.size > this.fileMaxSize){\r\n          this.$message.warning('文件后缀名必须为xls或xlsx（即Excel格式），文件大小不得大于2M');\r\n          this.fileList = [];\r\n          return false;\r\n        }\r\n        return true;\r\n      },\r\n      handleExceed(files, fileList){\r\n        this.$message.warning(`当前限制选择 1 个文件，本次共选择了 ${files.length + fileList.length} 个文件；文件后缀名必须为xls或xlsx（即Excel格式），文件大小不得大于2M`);\r\n      },\r\n      exportCheckfaildata(){\r\n        window.open(`/api/cnfic-contract-manage/blackwhitelist/export-checkfaildata?${website.tokenHeader}=${getToken()}&failRedisKey=${this.failRedisKey}`);\r\n      },\r\n      exportTemplate(){\r\n        window.open(`/api/cnfic-contract-manage/blackwhitelist/export-template?${website.tokenHeader}=${getToken()}`);\r\n      },\r\n        closeDialog(){\r\n            this.$emit(\"close\");\r\n        },\r\n        handleChange(response, file, fileList){\r\n            if (response){\r\n              this.passRedisKey = response.data.passRedisKey;\r\n              this.failRedisKey = response.data.failRedisKey;\r\n            }\r\n        },\r\n        onLoadSuccess(){\r\n            this.loading = true;\r\n            const filter = {\"passRedisKey\":this.passRedisKey};\r\n          checkpassdata(this.passPage.currentPage, this.passPage.pageSize, filter).then(res => {\r\n              const data = res.data.data;\r\n            this.passPage.total = data.total;\r\n            this.dataSuccess = data.records;\r\n            this.loading = false;\r\n          });\r\n        },\r\n      handlePassSizeChange(size){\r\n        this.passPage.pageSize=size;\r\n        this.onLoadSuccess();\r\n      },\r\n      handlePassCurrentChange(page){\r\n        this.passPage.currentPage=page;\r\n        this.onLoadSuccess();\r\n      },\r\n      onLoadFail(){\r\n          this.loading = true;\r\n          const filter = {\"failRedisKey\":this.failRedisKey};\r\n          checkfaildata(this.failPage.currentPage, this.failPage.pageSize, filter).then(res => {\r\n            const data = res.data.data;\r\n            this.failPage.total = data.total;\r\n            this.dataFail = data.records;\r\n            this.loading = false;\r\n        });\r\n      },\r\n      handleFailSizeChange(size){\r\n          this.failPage.pageSize=size;\r\n          this.onLoadFail();\r\n      },\r\n      handleFailCurrentChange(page){\r\n            this.failPage.currentPage=page;\r\n            this.onLoadFail();\r\n        },\r\n      submitpassdata(){\r\n          this.loading = true;\r\n          const filter = {\"passRedisKey\":this.passRedisKey};\r\n          submitpassdata(filter).then(res => {\r\n            this.submitPassNum = res.data;\r\n          }, error => {\r\n            window.console.log(error);\r\n          });\r\n        },\r\n      next(step){\r\n            this.activeStep=step;\r\n            if (step == 3 && this.passPage.total != 0){\r\n              this.submitpassdata();\r\n            }\r\n        }\r\n    }\r\n}\r\n</script>\r\n<style lang=\"scss\">\r\n.el-import-step{\r\n    margin-top: 1rem;\r\n    width: 100%;\r\n    &-download:first-child{\r\n        border-bottom: 1px solid #d9d9db;\r\n    }\r\n    &-download{\r\n        width: 100%;\r\n        display: flex;\r\n        justify-content: center;\r\n        align-items: center;\r\n        padding:1rem 0;\r\n        &-icon{\r\n            i{\r\n                color: #078ecf;\r\n                font-size: 40px;\r\n                padding:0 30px;\r\n            }\r\n        }\r\n        &-desc{\r\n            width:70%;\r\n            div{\r\n                padding:5px 0;\r\n            }\r\n            div:first-child{\r\n                font-size: 14px;\r\n            }\r\n            .el-link.el-link--primary{\r\n                color: #078ecf;\r\n            }\r\n            .download-tip{\r\n                font-size: 12px;\r\n                color: #9da7b0;\r\n            }\r\n        }\r\n    }\r\n    &-footer{\r\n        text-align: center;\r\n        width:100%;\r\n        margin-top: 1rem;\r\n        .el-button--small{\r\n            margin:0 1rem;\r\n        }\r\n    }\r\n    &-three{\r\n        text-align: center;\r\n        h3,div{\r\n            width: 100%;\r\n        }\r\n    }\r\n    .avue-crud__menu{\r\n        min-height: 30px;\r\n    }\r\n    .avue-crud__pagination{\r\n        display: none;\r\n    }\r\n    .el-import-list-header{\r\n        height: 40px;\r\n        line-height: 40px;\r\n        font-size: 14px;\r\n        color: #9da7b0;\r\n        .el-link{\r\n            vertical-align: initial;\r\n        }\r\n        a{\r\n            color: #078ecf;\r\n            margin: 0 10px;\r\n        }\r\n    }\r\n    .el-import-list-pagination{\r\n        text-align: center;\r\n        width:100%;\r\n        margin-top: 1rem;\r\n    }\r\n}\r\n</style>\r\n"],"sourceRoot":"src/views/contract/blackList"}]}