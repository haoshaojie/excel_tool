{"remainingRequest":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\babel-loader\\lib\\index.js!F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\src\\views\\contract\\contract\\components\\basicInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\src\\views\\contract\\contract\\components\\basicInfo.vue","mtime":1618568524334},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.array.find-index\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { getDictByCode } from \"@/api/system/dict\";\nimport customerDialog from \"@/views/contract/customer/customerDialog\";\nimport linkPersonDialog from \"@/views/contract/userAccount/linkPersonDialog\";\nimport { getContractList } from \"@/api/contract/user/orguser\";\nimport { getDept } from \"@/api/system/dept\";\nimport { getToken } from '@/util/auth';\nimport website from \"@/config/website\";\nexport default {\n  name: \"basic-info\",\n  components: {\n    customerDialog: customerDialog,\n    linkPersonDialog: linkPersonDialog\n  },\n  props: {\n    dicDataList: [],\n    basicInfo: {}\n  },\n  data: function data() {\n    return {\n      conLimitList: [],\n      //合约范围\n      conTypeList: [],\n      //合约类型\n      conStateList: [],\n      //合约状态\n      signStateList: [],\n      //签约状态\n      signTypeList: [],\n      //签约类型\n      renewalStateList: [],\n      //续约状态\n      customerDialogFlag: false,\n      showLinkPersonDialog: false,\n      headerObj: {\n        \"Authorization\": \"Basic \".concat(Base64.encode(\"\".concat(website.clientId, \":\").concat(website.clientSecret))),\n        \"TongTech-Auth\": 'Bearer ' + getToken(),\n        \"Blade-Auth\": 'Bearer ' + getToken()\n      },\n      //附件上传请求头参数\n      basicInfoRules: {\n        conName: [{\n          required: true,\n          message: '请输入合约名称',\n          trigger: \"blur\"\n        }],\n        conLimit: [{\n          required: true,\n          message: '请选择合约范围',\n          trigger: \"change\"\n        }],\n        conType: [{\n          required: true,\n          message: '请选择合约类型',\n          trigger: \"change\"\n        }],\n        conState: [{\n          required: true,\n          message: '请选择合约状态',\n          trigger: \"change\"\n        }],\n        deptId: [{\n          required: true,\n          message: '请选择所属部门',\n          trigger: \"change\"\n        }],\n        custName: [{\n          required: true,\n          message: '请选择客户',\n          trigger: \"change\"\n        }],\n        signState: [{\n          required: true,\n          message: '请选择签约状态',\n          trigger: \"change\"\n        }],\n        signType: [{\n          required: true,\n          message: '请选择签约类型',\n          trigger: \"change\"\n        }],\n        renewalState: [{\n          required: true,\n          message: '请选择续约状态',\n          trigger: \"change\"\n        }],\n        signDate: [{\n          required: true,\n          message: '请选择签约日期',\n          trigger: \"blur\"\n        }],\n        contractTime: [{\n          required: true,\n          message: '请选择合约起止日期',\n          trigger: \"blur\"\n        }]\n      },\n      option: {\n        calcHeight: 210,\n        searchShow: true,\n        searchMenuSpan: 6,\n        tip: false,\n        border: true,\n        index: false,\n        header: false,\n        menu: false,\n        selection: false,\n        column: [{\n          prop: \"contactPerson\",\n          label: \"联系人\"\n        }, {\n          prop: \"contactType\",\n          label: \"联系人类型\"\n        }, {\n          prop: \"contactPhone\",\n          label: \"联系方式\"\n        }, {\n          prop: \"contactEmail\",\n          label: \"邮箱\"\n        }, {\n          prop: \"contactDept\",\n          label: \"部门\"\n        }, {\n          prop: \"contactJob\",\n          label: \"职务\"\n        }, {\n          prop: \"custManager\",\n          label: \"客户经理\"\n        }, {\n          prop: \"custOrgName\",\n          label: \"所属机构\"\n        }]\n      }\n    };\n  },\n  mounted: function mounted() {\n    this.onLoad();\n  },\n  methods: {\n    handlePreview: function handlePreview() {},\n    handleRemove: function handleRemove(file) {\n      var index = this.basicInfo.fileList.findIndex(function (fileItem) {\n        return fileItem.uid === file.uid;\n      });\n      this.basicInfo.fileList.splice(index, 1);\n    },\n    beforeRemove: function beforeRemove() {},\n    handleSuccess: function handleSuccess(response, file, fileList) {\n      this.basicInfo.fileList = fileList;\n    },\n    //上传之前校验方法\n    onBeforeUpload: function onBeforeUpload(file) {\n      var fileName = file.name;\n      var filextension = fileName.substring(fileName.lastIndexOf(\".\"), fileName.length);\n      filextension = filextension.toLowerCase();\n      var typeRight = true;\n\n      if (filextension != '.pdf' && filextension != '.doc' && filextension != '.docx' && filextension != '.zip' && filextension != '.rar') {\n        typeRight = false;\n        this.$message.error('合同附件仅支持上传.doc .docx .pdf .rar .zip格式');\n      }\n\n      var isLt1M = file.size / 1024 / 1024 < 2;\n\n      if (!isLt1M) {\n        this.$message.error('上传文件大小不能超过 2MB!');\n      }\n\n      return typeRight && isLt1M;\n    },\n    //附件超出个数方法\n    handleExceed: function handleExceed() {\n      this.$message.error('最多支持5个附件');\n    },\n    saveBasic: function saveBasic() {\n      var _this = this;\n\n      this.$refs['basicInfo'].validate(function (valid) {\n        if (valid) {\n          _this.$emit(\"saveBasic\");\n        } else {\n          _this.$message.error('请输入必填字段');\n        }\n      });\n    },\n    next: function next() {\n      this.$emit(\"update\", 2);\n    },\n    //上级单位弹窗\n    addSuperUnit: function addSuperUnit() {\n      this.customerDialogFlag = true;\n    },\n    //接受选择客户\n    acceptSuperUnit: function acceptSuperUnit(row) {\n      var _this2 = this;\n\n      this.basicInfo.custName = row.custName;\n      this.basicInfo.custId = row.id;\n      this.data = []; //查询联系人信息，如果只有一个联系人，直接放到联系人列表里\n\n      getContractList(row.id).then(function (res) {\n        _this2.basicInfo.contactsNumber = res.data.data.length;\n\n        if (res.data.data.length == 1) {\n          _this2.basicInfo.custContract = res.data.data;\n          getDept(_this2.basicInfo.custContract[0].custOrg).then(function (r) {\n            _this2.basicInfo.custContract.custOrgName = r.data.data.deptName;\n          }, function (error) {\n            _this2.$message.error('所属机构未找到');\n          });\n        }\n      });\n    },\n    cancelCustomerDialog: function cancelCustomerDialog() {\n      this.customerDialogFlag = false;\n    },\n    //打开联系人选择页面\n    openLinkPersonDialog: function openLinkPersonDialog() {\n      if (this.basicInfo.custId == \"\") {\n        this.$message.error('请先选择客户');\n        return;\n      }\n\n      this.showLinkPersonDialog = true;\n    },\n    chooseLinkPerson: function chooseLinkPerson(row) {\n      this.basicInfo.custContract = [];\n      this.basicInfo.custContract.push(row);\n      this.basicInfo.custContractId = row.id;\n    },\n    cancelLinkPersonDialog: function cancelLinkPersonDialog() {\n      this.showLinkPersonDialog = false;\n    },\n    onLoad: function onLoad() {\n      var _this3 = this;\n\n      getDictByCode(this.CONSTANT.CONTRACT_SCOPE).then(function (res) {\n        _this3.conLimitList = res.data.data;\n      });\n      getDictByCode(this.CONSTANT.CONTRACT_TYPE).then(function (res) {\n        _this3.conTypeList = res.data.data;\n      });\n      getDictByCode(this.CONSTANT.CONTRACT_STATE).then(function (res) {\n        _this3.conStateList = res.data.data;\n      });\n      getDictByCode(this.CONSTANT.SIGN_STATE).then(function (res) {\n        _this3.signStateList = res.data.data;\n      });\n      getDictByCode(this.CONSTANT.SIGN_TYPE).then(function (res) {\n        _this3.signTypeList = res.data.data;\n      });\n      getDictByCode(this.CONSTANT.RENEWAL_STATE).then(function (res) {\n        _this3.renewalStateList = res.data.data;\n      });\n    }\n  }\n};",{"version":3,"sources":["basicInfo.vue"],"names":[],"mappings":"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","sourcesContent":["<!--基本信息--->\r\n<template>\r\n    <basic-container>\r\n        <div class=\"el-basic-title\">基本信息</div>\r\n        <div  class=\"el-basic-content\">\r\n            <el-form size=\"small\" ref=\"basicInfo\" label-position=\"left\" label-width=\"110px\" :model=\"basicInfo\" :inline=\"true\" :rules=\"basicInfoRules\">\r\n                <el-row>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"合约名称\" prop=\"conName\">\r\n                            <el-input placeholder=\"合约名称\" v-model=\"basicInfo.conName\"></el-input>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"合约范围\" prop=\"conLimit\">\r\n                            <el-radio-group v-model=\"basicInfo.conLimit\">\r\n                                <el-radio v-for=\"(item,i) in conLimitList\" :key=\"i\" :label=\"item.dictKey\">{{item.dictValue}}</el-radio>\r\n                            </el-radio-group>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                </el-row>\r\n                <el-row>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"合约类型\" prop=\"conType\">\r\n                            <el-select placeholder=\"合约类型\" v-model=\"basicInfo.conType\">\r\n                                <el-option v-for=\"(item,i) in conTypeList\" :key=\"i\" :label=\"item.dictValue\" :value=\"item.dictKey\"></el-option>\r\n                            </el-select>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"合约状态\" prop=\"conState\">\r\n                             <el-radio-group v-model=\"basicInfo.conState\">\r\n                                <el-radio v-for=\"(item,i) in conStateList\" :key=\"i\" :label=\"item.dictKey\">{{item.dictValue}}</el-radio>\r\n                            </el-radio-group>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                </el-row>\r\n                <el-row>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"所属部门\" prop=\"deptId\">\r\n                            <el-select placeholder=\"所属部门\" v-model=\"basicInfo.deptId\">\r\n                                <el-option v-for=\"(item,i) in dicDataList\" :key=\"i\" :label=\"item.title\" :value=\"item.value\"></el-option>\r\n                            </el-select>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"客户名称\" prop=\"custName\">\r\n                            <el-input v-model=\"basicInfo.custName\" disabled placeholder=\"请选择客户\" style=\"width: 100%;\">\r\n                                <el-button slot=\"append\" icon=\"el-icon-plus\" size=\"mini\" @click=\"addSuperUnit\"></el-button>\r\n                            </el-input>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                </el-row>\r\n                 <el-row>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"签约乙方\" prop=\"conPartb\">\r\n                            <el-input placeholder=\"签约乙方\" v-model=\"basicInfo.conPartb\"></el-input>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"签约状态\" prop=\"signState\">\r\n                            <el-select placeholder=\"签约状态\" v-model=\"basicInfo.signState\">\r\n                                <el-option v-for=\"(item,i) in signStateList\" :key=\"i\" :label=\"item.dictValue\" :value=\"item.dictKey\"></el-option>\r\n                            </el-select>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                </el-row>\r\n                <el-row>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"签约类型\" prop=\"signType\">\r\n                            <el-select placeholder=\"签约类型\" v-model=\"basicInfo.signType\">\r\n                                <el-option v-for=\"(item,i) in signTypeList\" :key=\"i\" :label=\"item.dictValue\" :value=\"item.dictKey\"></el-option>\r\n                            </el-select>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"续约状态\" prop=\"renewalState\">\r\n                             <el-select placeholder=\"续约状态\" v-model=\"basicInfo.renewalState\">\r\n                                <el-option v-for=\"(item,i) in renewalStateList\" :key=\"i\" :label=\"item.dictValue\" :value=\"item.dictKey\"></el-option>\r\n                            </el-select>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                </el-row>\r\n                <el-row>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"签约日期\" prop=\"signDate\">\r\n                            <el-date-picker \r\n                                placeholder=\"签约日期\"\r\n                                type=\"date\"\r\n                                value-format=\"yyyy-MM-dd\"\r\n                                format=\"yyyy-MM-dd\"\r\n                                v-model=\"basicInfo.signDate\">\r\n                            </el-date-picker>\r\n                            </el-form-item>\r\n                    </el-col>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"合约起止日期\" prop=\"contractTime\">\r\n                             <el-date-picker\r\n                                v-model=\"basicInfo.contractTime\"\r\n                                type=\"daterange\"\r\n                                value-format=\"yyyy-MM-dd\"\r\n                                format=\"yyyy-MM-dd\"\r\n                                range-separator=\"至\"\r\n                                start-placeholder=\"合约起始时间\"\r\n                                end-placeholder=\"合约终止时间\">\r\n                                </el-date-picker>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                </el-row>\r\n                <el-row>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"合约金额\" prop=\"conAmount\">\r\n                             <el-input placeholder=\"合约金额\" type=\"number\" v-model.number=\"basicInfo.conAmount\">\r\n                                <template slot=\"append\">元</template>\r\n                            </el-input>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"合约当年期金额\" prop=\"conCurrAmount\">\r\n                            <el-input placeholder=\"合约当年期金额\" type=\"number\" v-model.number=\"basicInfo.conCurrAmount\">\r\n                                <template slot=\"append\">元</template>\r\n                            </el-input>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                </el-row>\r\n                <el-row>\r\n                    <el-col>\r\n                        <el-form-item label=\"具体服务要求\" prop=\"conDemand\">\r\n                            <el-input \r\n                            placeholder=\"具体服务要求\" \r\n                            type=\"textarea\" \r\n                            v-model=\"basicInfo.conDemand\"\r\n                            :autosize=\"{minRows:4,maxRows:6}\"\r\n                            ></el-input>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                </el-row>\r\n                <el-row>\r\n                    <el-col>\r\n                        <el-form-item label=\"合约附件\">\r\n                           <el-upload\r\n                                action=\"/api/cnfic-resource/oss/file/putFile\"\r\n                                :headers=\"headerObj\"\r\n                                :on-preview=\"handlePreview\"\r\n                                :on-remove=\"handleRemove\"\r\n                                :before-remove=\"beforeRemove\"\r\n                                :before-upload=\"onBeforeUpload\"\r\n                                :on-success=\"handleSuccess\"\r\n                                multiple\r\n                                :on-exceed=\"handleExceed\"\r\n                                accept=\".pdf, .doc, .docx, .rar, .zip\"\r\n                                :limit=\"5\"\r\n                                :file-list=\"basicInfo.fileList\">\r\n                                <el-button size=\"small\" type=\"primary\">添加附件</el-button>\r\n                                合同附件支持上传.docx .doc .pdf .rar .zip格式，最多支持5个附件，单个附件不大于2M\r\n                                </el-upload>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                </el-row>\r\n                <el-row>\r\n                    <el-col :span=\"24\">\r\n                        <el-form-item label=\"合约联系人\">\r\n                           <el-button icon=\"el-icon-plus\" class=\"add-contacts\" @click=\"openLinkPersonDialog\">选择联系人({{basicInfo.contactsNumber}})</el-button>\r\n                           <avue-crud\r\n                            :option=\"option\"\r\n                            :data=\"basicInfo.custContract\"\r\n                           ></avue-crud>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                </el-row>\r\n                 <el-row>\r\n                    <el-col :span=\"24\">\r\n                        <el-form-item class=\"el-step-footer\">\r\n                            <el-button type=\"primary\" @click=\"saveBasic\">保&nbsp;&nbsp;&nbsp;存</el-button>\r\n                             <el-button type=\"primary\" plain @click=\"next\">下一步</el-button>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                 </el-row>\r\n            </el-form>\r\n        </div>\r\n        <customer-dialog ref=\"customerDialog\" :customerDialogFlag=\"customerDialogFlag\" @acceptSuperUnit=\"acceptSuperUnit\"\r\n                     @cancelCustomerDialog=\"cancelCustomerDialog\"></customer-dialog>\r\n        <link-person-dialog ref=\"linkPersonDialog\"\r\n                        :showLinkPersonDialog=\"showLinkPersonDialog\"\r\n                        :customerId=\"basicInfo.custId\"\r\n                        @chooseLinkPerson=\"chooseLinkPerson\"\r\n                        @cancelLinkPersonDialog=\"cancelLinkPersonDialog\"/>\r\n    </basic-container>\r\n</template>\r\n<script>\r\nimport {getDictByCode} from \"@/api/system/dict\";\r\nimport customerDialog from \"@/views/contract/customer/customerDialog\";\r\nimport linkPersonDialog from \"@/views/contract/userAccount/linkPersonDialog\";\r\nimport {getContractList} from \"@/api/contract/user/orguser\";\r\nimport {getDept} from \"@/api/system/dept\";\r\nimport {getToken} from '@/util/auth';\r\nimport website from \"@/config/website\";\r\nexport default {\r\n    name:\"basic-info\",\r\n    components: {\r\n      customerDialog,\r\n      linkPersonDialog\r\n    },\r\n    props:{\r\n      dicDataList:[],\r\n      basicInfo:{}\r\n    },\r\n    data(){\r\n        return{\r\n            conLimitList:[],//合约范围\r\n            conTypeList:[],//合约类型\r\n            conStateList:[],//合约状态\r\n            signStateList:[],//签约状态\r\n            signTypeList:[],//签约类型\r\n            renewalStateList:[],//续约状态\r\n            customerDialogFlag:false,\r\n            showLinkPersonDialog:false,\r\n            headerObj: {\r\n                \"Authorization\": `Basic ${Base64.encode(`${website.clientId}:${website.clientSecret}`)}`,\r\n                \"TongTech-Auth\": 'Bearer ' + getToken(),\r\n                \"Blade-Auth\": 'Bearer ' + getToken()\r\n            },//附件上传请求头参数\r\n            basicInfoRules:{\r\n                conName:[{required: true,message: '请输入合约名称',trigger: \"blur\"}],\r\n                conLimit:[{required: true,message: '请选择合约范围',trigger: \"change\"}],\r\n                conType:[{required: true,message: '请选择合约类型',trigger: \"change\"}],\r\n                conState:[{required: true,message: '请选择合约状态',trigger: \"change\"}],\r\n                deptId:[{required: true,message: '请选择所属部门',trigger: \"change\"}],\r\n                custName:[{required: true,message: '请选择客户',trigger: \"change\"}],\r\n                signState:[{required: true,message: '请选择签约状态',trigger: \"change\"}],\r\n                signType:[{required: true,message: '请选择签约类型',trigger: \"change\"}],\r\n                renewalState:[{required: true,message: '请选择续约状态',trigger: \"change\"}],\r\n                signDate:[{required: true,message: '请选择签约日期',trigger: \"blur\"}],\r\n                contractTime:[{required: true,message: '请选择合约起止日期',trigger: \"blur\"}],\r\n            },\r\n            option:{\r\n                calcHeight: 210,\r\n                searchShow: true,\r\n                searchMenuSpan: 6,\r\n                tip: false,\r\n                border: true,\r\n                index: false,\r\n                header:false,\r\n                menu:false,\r\n                selection: false,\r\n                column:[\r\n                    {\r\n                        prop:\"contactPerson\",\r\n                        label:\"联系人\",\r\n                    },\r\n                    {\r\n                        prop:\"contactType\",\r\n                        label:\"联系人类型\",\r\n                    },\r\n                    {\r\n                        prop:\"contactPhone\",\r\n                        label:\"联系方式\",\r\n                    },\r\n                    {\r\n                        prop:\"contactEmail\",\r\n                        label:\"邮箱\",\r\n                    },\r\n                    {\r\n                        prop:\"contactDept\",\r\n                        label:\"部门\",\r\n                    },\r\n                    {\r\n                        prop:\"contactJob\",\r\n                        label:\"职务\",\r\n                    },\r\n                     {\r\n                        prop:\"custManager\",\r\n                        label:\"客户经理\",\r\n                    },\r\n                    {\r\n                        prop:\"custOrgName\",\r\n                        label:\"所属机构\",\r\n                    }\r\n                ]\r\n            }\r\n        }\r\n    },\r\n    mounted(){\r\n      this.onLoad();\r\n    },\r\n    methods:{\r\n      handlePreview(){},\r\n      handleRemove(file){\r\n        let index = this.basicInfo.fileList.findIndex( fileItem => {\r\n            return fileItem.uid === file.uid\r\n        })\r\n        this.basicInfo.fileList.splice(index, 1)\r\n      },\r\n      beforeRemove(){},\r\n      handleSuccess(response, file, fileList){\r\n          this.basicInfo.fileList = fileList;\r\n      },\r\n      //上传之前校验方法\r\n      onBeforeUpload(file){\r\n        var fileName = file.name;\r\n        var filextension=fileName.substring(fileName.lastIndexOf(\".\"),fileName.length);\r\n        filextension=filextension.toLowerCase();\r\n        var typeRight=true;\r\n        if((filextension!='.pdf')&&(filextension!='.doc')&&(filextension!='.docx')&&(filextension!='.zip')&&(filextension!='.rar')){\r\n          typeRight = false;\r\n          this.$message.error('合同附件仅支持上传.doc .docx .pdf .rar .zip格式');\r\n        }\r\n        const isLt1M = file.size / 1024 / 1024 < 2;\r\n        if (!isLt1M) {\r\n            this.$message.error('上传文件大小不能超过 2MB!');\r\n        }\r\n        return typeRight && isLt1M;\r\n      },\r\n      //附件超出个数方法\r\n      handleExceed(){\r\n          this.$message.error('最多支持5个附件');\r\n      },\r\n      saveBasic(){\r\n        this.$refs['basicInfo'].validate((valid)=>{\r\n          if(valid){\r\n            this.$emit(\"saveBasic\");\r\n          }else{\r\n            this.$message.error('请输入必填字段');\r\n          }\r\n        })\r\n      },\r\n      next(){\r\n          this.$emit(\"update\",2);\r\n      },\r\n      //上级单位弹窗\r\n      addSuperUnit() {\r\n        this.customerDialogFlag = true\r\n      },\r\n      //接受选择客户\r\n      acceptSuperUnit(row) {\r\n        this.basicInfo.custName = row.custName;\r\n        this.basicInfo.custId = row.id;\r\n        this.data = [];\r\n        //查询联系人信息，如果只有一个联系人，直接放到联系人列表里\r\n        getContractList(row.id).then(res => {\r\n          this.basicInfo.contactsNumber = res.data.data.length;\r\n          if(res.data.data.length==1){\r\n            this.basicInfo.custContract = res.data.data;\r\n            getDept(this.basicInfo.custContract[0].custOrg).then(r => {\r\n              this.basicInfo.custContract.custOrgName = r.data.data.deptName;\r\n            },error =>{\r\n              this.$message.error('所属机构未找到');\r\n            });\r\n          }\r\n        })\r\n      },\r\n      cancelCustomerDialog() {\r\n        this.customerDialogFlag = false\r\n      },\r\n      //打开联系人选择页面\r\n      openLinkPersonDialog() {\r\n        if(this.basicInfo.custId == \"\"){\r\n          this.$message.error('请先选择客户');\r\n          return;\r\n        }\r\n        this.showLinkPersonDialog = true;\r\n      },\r\n      chooseLinkPerson(row) {\r\n        this.basicInfo.custContract = [];\r\n        this.basicInfo.custContract.push(row);\r\n        this.basicInfo.custContractId = row.id;\r\n      },\r\n      cancelLinkPersonDialog() {\r\n        this.showLinkPersonDialog = false;\r\n      },\r\n      onLoad() {\r\n        getDictByCode(this.CONSTANT.CONTRACT_SCOPE).then(res => {\r\n          this.conLimitList=res.data.data\r\n        });\r\n        getDictByCode(this.CONSTANT.CONTRACT_TYPE).then(res => {\r\n          this.conTypeList=res.data.data\r\n        });\r\n        getDictByCode(this.CONSTANT.CONTRACT_STATE).then(res => {\r\n          this.conStateList=res.data.data\r\n        });\r\n        getDictByCode(this.CONSTANT.SIGN_STATE).then(res => {\r\n          this.signStateList=res.data.data\r\n        });\r\n        getDictByCode(this.CONSTANT.SIGN_TYPE).then(res => {\r\n          this.signTypeList=res.data.data\r\n        });\r\n        getDictByCode(this.CONSTANT.RENEWAL_STATE).then(res => {\r\n          this.renewalStateList=res.data.data\r\n        });\r\n      }\r\n    }\r\n}\r\n</script>\r\n"],"sourceRoot":"src/views/contract/contract/components"}]}