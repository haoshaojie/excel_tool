{"remainingRequest":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\babel-loader\\lib\\index.js!F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\eslint-loader\\index.js??ref--13-0!F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\src\\store\\modules\\user.js","dependencies":[{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\src\\store\\modules\\user.js","mtime":1618794737778},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.symbol.async-iterator\";\nimport \"core-js/modules/es6.symbol\";\nimport \"core-js/modules/es6.string.iterator\";\nimport \"core-js/modules/es6.array.from\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport _typeof from \"F:/\\u4E1C\\u65B9\\u901A/source/b_zwj/xinhua-finance-web/node_modules/@babel/runtime/helpers/esm/typeof\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/web.dom.iterable\";\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport { setToken, removeToken } from '@/util/auth';\nimport { setStore, getStore } from '@/util/store';\nimport { isURL, validatenull } from '@/util/validate';\nimport { deepClone } from '@/util/util';\nimport webiste from '@/config/website';\nimport { Message } from 'element-ui';\nimport { loginByUsername, loginBySocial, getUserInfo, getMenu, getTopMenu, logout, refreshToken, getButtons } from '@/api/user';\nimport { queryPassword } from '@/api/contract/password/password';\n\nfunction addPath(ele, first) {\n  var menu = webiste.menu;\n  var propsConfig = menu.props;\n  var propsDefault = {\n    label: propsConfig.label || 'name',\n    path: propsConfig.path || 'path',\n    icon: propsConfig.icon || 'icon',\n    children: propsConfig.children || 'children'\n  };\n  var icon = ele[propsDefault.icon];\n  ele[propsDefault.icon] = validatenull(icon) ? menu.iconDefault : icon;\n  var isChild = ele[propsDefault.children] && ele[propsDefault.children].length !== 0;\n  if (!isChild) ele[propsDefault.children] = [];\n\n  if (!isChild && first && !isURL(ele[propsDefault.path])) {\n    ele[propsDefault.path] = ele[propsDefault.path] + '/index';\n  } else {\n    ele[propsDefault.children].forEach(function (child) {\n      addPath(child);\n    });\n  }\n}\n\nvar user = {\n  state: {\n    userInfo: getStore({\n      name: 'userInfo'\n    }) || [],\n    permission: getStore({\n      name: 'permission'\n    }) || {},\n    roles: [],\n    menu: getStore({\n      name: 'menu'\n    }) || [],\n    menuAll: [],\n    token: getStore({\n      name: 'token'\n    }) || ''\n  },\n  actions: {\n    //根据用户名登录\n    LoginByUsername: function LoginByUsername(_ref, userInfo) {\n      var commit = _ref.commit;\n      return new Promise(function (resolve, reject) {\n        loginByUsername(userInfo.tenantId, userInfo.username, userInfo.password, userInfo.type, userInfo.key, userInfo.code).then(function (res) {\n          var data = res.data.data;\n          commit('SET_TOKEN', data.accessToken);\n          commit('SET_USER_INFO', data);\n          commit('DEL_ALL_TAG');\n          commit('CLEAR_LOCK'); // var code=407;\n          // queryPassword(data.userId).then(item=>{\n          //   code=200\n          // })\n\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    //根据第三方信息登录\n    LoginBySocial: function LoginBySocial(_ref2, userInfo) {\n      var commit = _ref2.commit;\n      return new Promise(function (resolve) {\n        loginBySocial(userInfo.tenantId, userInfo.source, userInfo.code, userInfo.state).then(function (res) {\n          var data = res.data;\n\n          if (data.code == 200) {\n            commit('SET_TOKEN', data.data.accessToken);\n            commit('SET_REFRESH_TOKEN', data.data.refreshToken);\n            commit('SET_USER_INFO', data.data);\n            commit('DEL_ALL_TAG');\n            commit('CLEAR_LOCK');\n          } else {\n            Message({\n              message: data.msg,\n              type: 'error'\n            });\n          }\n\n          resolve();\n        });\n      });\n    },\n    //根据手机号登录\n    LoginByPhone: function LoginByPhone(_ref3, userInfo) {\n      var commit = _ref3.commit;\n      return new Promise(function (resolve) {\n        loginByUsername(userInfo.phone, userInfo.code).then(function (res) {\n          var data = res.data.data;\n          commit('SET_TOKEN', data);\n          commit('DEL_ALL_TAG');\n          commit('CLEAR_LOCK');\n          resolve();\n        });\n      });\n    },\n    GetUserInfo: function GetUserInfo(_ref4) {\n      var commit = _ref4.commit;\n      return new Promise(function (resolve, reject) {\n        getUserInfo().then(function (res) {\n          var data = res.data.data;\n          commit('SET_ROLES', data.roles);\n          resolve(data);\n        }).catch(function (err) {\n          reject(err);\n        });\n      });\n    },\n    //刷新token\n    RefreshToken: function RefreshToken(_ref5) {\n      var state = _ref5.state,\n          commit = _ref5.commit;\n      return new Promise(function (resolve, reject) {\n        refreshToken(state.refreshToken).then(function (res) {\n          var data = res.data.data;\n          commit('SET_TOKEN', data);\n          resolve(data);\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 登出\n    LogOut: function LogOut(_ref6) {\n      var commit = _ref6.commit;\n      return new Promise(function (resolve, reject) {\n        logout().then(function () {\n          commit('SET_TOKEN', '');\n          commit('SET_MENU', []);\n          commit('SET_MENU_ALL', []);\n          commit('SET_ROLES', []);\n          commit('DEL_ALL_TAG');\n          commit('CLEAR_LOCK');\n          removeToken();\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    //注销session\n    FedLogOut: function FedLogOut(_ref7) {\n      var commit = _ref7.commit;\n      return new Promise(function (resolve) {\n        commit('SET_TOKEN', '');\n        commit('SET_MENU', []);\n        commit('SET_MENU_ALL', []);\n        commit('SET_ROLES', []);\n        commit('DEL_ALL_TAG');\n        commit('CLEAR_LOCK');\n        removeToken();\n        resolve();\n      });\n    },\n    GetTopMenu: function GetTopMenu() {\n      return new Promise(function (resolve) {\n        getTopMenu().then(function (res) {\n          var data = res.data.data || [];\n          resolve(data);\n        });\n      });\n    },\n    //获取系统菜单\n    GetMenu: function GetMenu(_ref8, parentId) {\n      var commit = _ref8.commit,\n          dispatch = _ref8.dispatch;\n      return new Promise(function (resolve) {\n        getMenu(parentId).then(function (res) {\n          var data = res.data.data;\n          var menu = deepClone(data);\n          menu.forEach(function (ele) {\n            addPath(ele, true);\n          });\n          commit('SET_MENU', menu);\n          commit('SET_MENU_ALL', menu);\n          dispatch('GetButtons');\n          resolve(menu);\n        });\n      });\n    },\n    GetButtons: function GetButtons(_ref9) {\n      var commit = _ref9.commit;\n      return new Promise(function (resolve) {\n        getButtons().then(function (res) {\n          var data = res.data.data;\n          commit('SET_PERMISSION', data);\n          resolve();\n        });\n      });\n    }\n  },\n  mutations: {\n    SET_TOKEN: function SET_TOKEN(state, token) {\n      setToken(token);\n      state.token = token;\n      setStore({\n        name: 'token',\n        content: state.token,\n        type: 'session'\n      });\n    },\n    SET_USER_INFO: function SET_USER_INFO(state, userInfo) {\n      state.userInfo = userInfo;\n      setStore({\n        name: 'userInfo',\n        content: state.userInfo\n      });\n    },\n    SET_MENU_ALL: function SET_MENU_ALL(state, menuAll) {\n      state.menuAll = menuAll;\n      setStore({\n        name: 'menuAll',\n        content: state.menuAll,\n        type: 'session'\n      });\n    },\n    SET_MENU: function SET_MENU(state, menu) {\n      state.menu = menu;\n      setStore({\n        name: 'menu',\n        content: state.menu,\n        type: 'session'\n      });\n      if (validatenull(menu)) return; //合并动态路由去重\n\n      var menuAll = state.menuAll;\n      menuAll = menuAll.concat(menu).reverse();\n      var newMenu = [];\n\n      var _iterator = _createForOfIteratorHelper(menuAll),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var item1 = _step.value;\n          var flag = true;\n\n          var _iterator2 = _createForOfIteratorHelper(newMenu),\n              _step2;\n\n          try {\n            for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n              var item2 = _step2.value;\n\n              if (item1.name === item2.name || item1.path === item2.path) {\n                flag = false;\n              }\n            }\n          } catch (err) {\n            _iterator2.e(err);\n          } finally {\n            _iterator2.f();\n          }\n\n          if (flag) newMenu.push(item1);\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n\n      state.menuAll = newMenu;\n      setStore({\n        name: 'menuAll',\n        content: state.menuAll,\n        type: 'session'\n      });\n    },\n    SET_ROLES: function SET_ROLES(state, roles) {\n      state.roles = roles;\n    },\n    SET_PERMISSION: function SET_PERMISSION(state, permission) {\n      var result = [];\n\n      function getCode(list) {\n        list.forEach(function (ele) {\n          if (_typeof(ele) === 'object') {\n            var chiildren = ele.children;\n            var code = ele.code;\n\n            if (chiildren) {\n              getCode(chiildren);\n            } else {\n              result.push(code);\n            }\n          }\n        });\n      }\n\n      getCode(permission);\n      state.permission = {};\n      result.forEach(function (ele) {\n        state.permission[ele] = true;\n      });\n      setStore({\n        name: 'permission',\n        content: state.permission,\n        type: 'session'\n      });\n    }\n  }\n};\nexport default user;",{"version":3,"sources":["F:/东方通/source/b_zwj/xinhua-finance-web/src/store/modules/user.js"],"names":["setToken","removeToken","setStore","getStore","isURL","validatenull","deepClone","webiste","Message","loginByUsername","loginBySocial","getUserInfo","getMenu","getTopMenu","logout","refreshToken","getButtons","queryPassword","addPath","ele","first","menu","propsConfig","props","propsDefault","label","path","icon","children","iconDefault","isChild","length","forEach","child","user","state","userInfo","name","permission","roles","menuAll","token","actions","LoginByUsername","commit","Promise","resolve","reject","tenantId","username","password","type","key","code","then","res","data","accessToken","catch","error","LoginBySocial","source","message","msg","LoginByPhone","phone","GetUserInfo","err","RefreshToken","LogOut","FedLogOut","GetTopMenu","GetMenu","parentId","dispatch","GetButtons","mutations","SET_TOKEN","content","SET_USER_INFO","SET_MENU_ALL","SET_MENU","concat","reverse","newMenu","item1","flag","item2","push","SET_ROLES","SET_PERMISSION","result","getCode","list","chiildren"],"mappings":"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","sourcesContent":["import {setToken, removeToken} from '@/util/auth'\r\nimport {setStore, getStore} from '@/util/store'\r\nimport {isURL, validatenull} from '@/util/validate'\r\nimport {deepClone} from '@/util/util'\r\nimport webiste from '@/config/website'\r\nimport {Message} from 'element-ui'\r\nimport {loginByUsername, loginBySocial, getUserInfo, getMenu, getTopMenu, logout, refreshToken, getButtons} from '@/api/user'\r\nimport {queryPassword} from '@/api/contract/password/password'\r\n\r\n\r\nfunction addPath(ele, first) {\r\n  const menu = webiste.menu;\r\n  const propsConfig = menu.props;\r\n  const propsDefault = {\r\n    label: propsConfig.label || 'name',\r\n    path: propsConfig.path || 'path',\r\n    icon: propsConfig.icon || 'icon',\r\n    children: propsConfig.children || 'children'\r\n  };\r\n  const icon = ele[propsDefault.icon];\r\n  ele[propsDefault.icon] = validatenull(icon) ? menu.iconDefault : icon;\r\n  const isChild = ele[propsDefault.children] && ele[propsDefault.children].length !== 0;\r\n  if (!isChild) ele[propsDefault.children] = [];\r\n  if (!isChild && first && !isURL(ele[propsDefault.path])) {\r\n    ele[propsDefault.path] = ele[propsDefault.path] + '/index'\r\n  } else {\r\n    ele[propsDefault.children].forEach(child => {\r\n      addPath(child);\r\n    })\r\n  }\r\n\r\n}\r\n\r\nconst user = {\r\n  state: {\r\n    userInfo: getStore({name: 'userInfo'}) || [],\r\n    permission: getStore({name: 'permission'}) || {},\r\n    roles: [],\r\n    menu: getStore({name: 'menu'}) || [],\r\n    menuAll: [],\r\n    token: getStore({name: 'token'}) || '',\r\n  },\r\n  actions: {\r\n    //根据用户名登录\r\n    LoginByUsername({commit}, userInfo) {\r\n      return new Promise((resolve, reject) => {\r\n        loginByUsername(userInfo.tenantId, userInfo.username, userInfo.password, userInfo.type, userInfo.key, userInfo.code).then(res => {\r\n          const data = res.data.data;\r\n          commit('SET_TOKEN', data.accessToken);\r\n          commit('SET_USER_INFO', data);\r\n          commit('DEL_ALL_TAG');\r\n          commit('CLEAR_LOCK');\r\n          // var code=407;\r\n          // queryPassword(data.userId).then(item=>{\r\n          //   code=200\r\n          // })\r\n          resolve();\r\n        }).catch(error => {\r\n          reject(error);\r\n        })\r\n      })\r\n    },\r\n    //根据第三方信息登录\r\n    LoginBySocial({ commit }, userInfo) {\r\n      return new Promise((resolve) => {\r\n        loginBySocial(userInfo.tenantId, userInfo.source, userInfo.code, userInfo.state).then(res => {\r\n          const data = res.data;\r\n          if (data.code == 200) {\r\n            commit('SET_TOKEN', data.data.accessToken);\r\n            commit('SET_REFRESH_TOKEN', data.data.refreshToken);\r\n            commit('SET_USER_INFO', data.data);\r\n            commit('DEL_ALL_TAG');\r\n            commit('CLEAR_LOCK');\r\n          } else {\r\n            Message({\r\n              message: data.msg,\r\n              type: 'error'\r\n            })\r\n          }\r\n          resolve();\r\n        })\r\n      })\r\n    },\r\n    //根据手机号登录\r\n    LoginByPhone({commit}, userInfo) {\r\n      return new Promise((resolve) => {\r\n        loginByUsername(userInfo.phone, userInfo.code).then(res => {\r\n          const data = res.data.data;\r\n          commit('SET_TOKEN', data);\r\n          commit('DEL_ALL_TAG');\r\n          commit('CLEAR_LOCK');\r\n          resolve();\r\n        })\r\n      })\r\n    },\r\n    GetUserInfo({commit}) {\r\n      return new Promise((resolve, reject) => {\r\n        getUserInfo().then((res) => {\r\n          const data = res.data.data;\r\n          commit('SET_ROLES', data.roles);\r\n          resolve(data);\r\n        }).catch(err => {\r\n          reject(err);\r\n        })\r\n      })\r\n    },\r\n    //刷新token\r\n    RefreshToken({state, commit}) {\r\n      return new Promise((resolve, reject) => {\r\n        refreshToken(state.refreshToken).then(res => {\r\n          const data = res.data.data;\r\n          commit('SET_TOKEN', data);\r\n          resolve(data);\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n    // 登出\r\n    LogOut({commit}) {\r\n      return new Promise((resolve, reject) => {\r\n        logout().then(() => {\r\n          commit('SET_TOKEN', '');\r\n          commit('SET_MENU', [])\r\n          commit('SET_MENU_ALL', []);\r\n          commit('SET_ROLES', []);\r\n          commit('DEL_ALL_TAG');\r\n          commit('CLEAR_LOCK');\r\n          removeToken()\r\n          resolve()\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n    //注销session\r\n    FedLogOut({commit}) {\r\n      return new Promise(resolve => {\r\n        commit('SET_TOKEN', '');\r\n        commit('SET_MENU', []);\r\n        commit('SET_MENU_ALL', []);\r\n        commit('SET_ROLES', []);\r\n        commit('DEL_ALL_TAG');\r\n        commit('CLEAR_LOCK');\r\n        removeToken()\r\n        resolve()\r\n      })\r\n    },\r\n    GetTopMenu() {\r\n      return new Promise(resolve => {\r\n        getTopMenu().then((res) => {\r\n          const data = res.data.data || []\r\n          resolve(data)\r\n        })\r\n      })\r\n    },\r\n    //获取系统菜单\r\n    GetMenu({commit, dispatch}, parentId) {\r\n      return new Promise(resolve => {\r\n        getMenu(parentId).then((res) => {\r\n          const data = res.data.data\r\n          let menu = deepClone(data);\r\n          menu.forEach(ele => {\r\n            addPath(ele, true);\r\n          })\r\n          commit('SET_MENU', menu);\r\n          commit('SET_MENU_ALL', menu);\r\n          dispatch('GetButtons');\r\n          resolve(menu)\r\n        })\r\n      })\r\n    },\r\n    GetButtons({commit}) {\r\n      return new Promise((resolve) => {\r\n        getButtons().then(res => {\r\n          const data = res.data.data;\r\n          commit('SET_PERMISSION', data);\r\n          resolve();\r\n        })\r\n      })\r\n    },\r\n  },\r\n  mutations: {\r\n    SET_TOKEN: (state, token) => {\r\n      setToken(token)\r\n      state.token = token;\r\n      setStore({name: 'token', content: state.token, type: 'session'})\r\n    },\r\n    SET_USER_INFO: (state, userInfo) => {\r\n      state.userInfo = userInfo;\r\n      setStore({name: 'userInfo', content: state.userInfo})\r\n    },\r\n    SET_MENU_ALL: (state, menuAll) => {\r\n      state.menuAll = menuAll\r\n      setStore({name: 'menuAll', content: state.menuAll, type: 'session'})\r\n    },\r\n    SET_MENU: (state, menu) => {\r\n      state.menu = menu\r\n      setStore({name: 'menu', content: state.menu, type: 'session'})\r\n      if (validatenull(menu)) return;\r\n      //合并动态路由去重\r\n      let menuAll = state.menuAll;\r\n      menuAll = menuAll.concat(menu).reverse();\r\n      let newMenu = [];\r\n      for (let item1 of menuAll) {\r\n        let flag = true;\r\n        for (let item2 of newMenu) {\r\n          if (item1.name === item2.name || item1.path === item2.path) {\r\n            flag = false;\r\n          }\r\n        }\r\n        if (flag) newMenu.push(item1);\r\n      }\r\n      state.menuAll = newMenu;\r\n      setStore({name: 'menuAll', content: state.menuAll, type: 'session'})\r\n    },\r\n    SET_ROLES: (state, roles) => {\r\n      state.roles = roles;\r\n    },\r\n    SET_PERMISSION: (state, permission) => {\r\n      let result = [];\r\n\r\n      function getCode(list) {\r\n        list.forEach(ele => {\r\n          if (typeof (ele) === 'object') {\r\n            const chiildren = ele.children;\r\n            const code = ele.code;\r\n            if (chiildren) {\r\n              getCode(chiildren)\r\n            } else {\r\n              result.push(code);\r\n            }\r\n          }\r\n\r\n        })\r\n      }\r\n\r\n      getCode(permission);\r\n      state.permission = {};\r\n      result.forEach(ele => {\r\n        state.permission[ele] = true;\r\n      });\r\n      setStore({name: 'permission', content: state.permission, type: 'session'})\r\n    }\r\n  }\r\n\r\n}\r\nexport default user\r\n"]}]}