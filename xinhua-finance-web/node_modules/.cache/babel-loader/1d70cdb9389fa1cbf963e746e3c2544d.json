{"remainingRequest":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\babel-loader\\lib\\index.js!F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\src\\views\\contract\\user\\uploadUserDialog.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\src\\views\\contract\\user\\uploadUserDialog.vue","mtime":1618541026435},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { checkpassdata, submitpassdata as _submitpassdata } from \"@/api/contract/user/personaluser\";\nimport website from \"@/config/website\";\nimport { getToken } from '@/util/auth';\nexport default {\n  name: \"upload-user-dialog\",\n  props: {\n    uploadUserDialogFlag: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data: function data() {\n    return {\n      loading: false,\n      activeStep: 1,\n      fileList: [],\n      headerObj: {\n        \"Authorization\": \"Basic \".concat(Base64.encode(\"\".concat(website.clientId, \":\").concat(website.clientSecret))),\n        \"TongTech-Auth\": 'Bearer ' + getToken(),\n        \"Blade-Auth\": 'Bearer ' + getToken()\n      },\n      //附件上传请求头参数\n      passPage: {\n        pageSize: 10,\n        currentPage: 1,\n        total: 0\n      },\n      failPage: {\n        pageSize: 10,\n        currentPage: 1,\n        total: 0\n      },\n      dataSuccess: [{\n        custName: '张三',\n        custTypeName: '利率债_金融债_IBABS',\n        custStateName: 'XHCJ001',\n        businessChanceName: '中央国债登记结算有限责任公司',\n        businessDesc: '行情数据',\n        repeatTip: '提示信息'\n      }],\n      dataFail: [{\n        custName: '张三',\n        custTypeName: '利率债_金融债_IBABS',\n        custStateName: 'XHCJ001',\n        businessChanceName: '中央国债登记结算有限责任公司',\n        businessDesc: '行情数据',\n        msg: \"\"\n      }],\n      optionSuccess: {\n        calcHeight: 100,\n        searchShow: true,\n        searchMenuSpan: 6,\n        border: true,\n        index: false,\n        viewBtn: false,\n        addBtn: false,\n        refreshBtn: false,\n        columnBtn: false,\n        menu: false,\n        column: [{\n          label: '部门',\n          prop: 'custOrg'\n        }, {\n          label: '邮箱',\n          prop: 'userEmail'\n        }, {\n          label: '用户描述',\n          prop: 'userDesc'\n        }, {\n          label: '用户类型',\n          prop: 'userTypeName'\n        }, {\n          label: '客户经理',\n          prop: 'custManagerName'\n        }]\n      },\n      optionFail: {\n        calcHeight: 210,\n        searchShow: true,\n        searchMenuSpan: 6,\n        border: true,\n        index: false,\n        viewBtn: false,\n        addBtn: false,\n        refreshBtn: false,\n        columnBtn: false,\n        menu: false,\n        column: [{\n          label: '部门',\n          prop: 'custOrg'\n        }, {\n          label: '邮箱',\n          prop: 'userEmail'\n        }, {\n          label: '用户描述',\n          prop: 'userDesc'\n        }, {\n          label: '用户类型',\n          prop: 'userTypeName'\n        }, {\n          label: '客户经理',\n          prop: 'custManagerName'\n        }, {\n          label: '错误提示',\n          prop: 'failMsg'\n        }]\n      },\n      redisKey: \"\",\n      submitPassNum: 0,\n      fileMaxSize: 2 * 1024 * 1024\n    };\n  },\n  mounted: function mounted() {},\n  methods: {\n    checkFileSize: function checkFileSize(file) {\n      if (file && file.size > this.fileMaxSize) {\n        this.$message.error('文件后缀名必须为xls或xlsx（即Excel格式），文件大小不得大于2M');\n        this.fileList = [];\n        return false;\n      }\n\n      return true;\n    },\n    exportCheckfaildata: function exportCheckfaildata() {\n      // window.open(`/api/cnfic-contract-manage/blackwhitelist/export-checkfaildata?${website.tokenHeader}=${getToken()}&failRedisKey=${this.failRedisKey}`);\n      window.open(\"/api/cnfic-contract-manage/orguser/downloadUserTemplate?\".concat(website.tokenHeader, \"=\").concat(getToken(), \"&key=\").concat(this.redisKey));\n    },\n    exportTemplate: function exportTemplate() {\n      window.open(\"/api/cnfic-contract-manage/orguser/downloadUserTemplate?\".concat(website.tokenHeader, \"=\").concat(getToken()));\n    },\n    closeDialog: function closeDialog() {\n      this.next(1);\n      this.$emit(\"cancelUploadUserDialog\");\n    },\n    handleChange: function handleChange(response, file, fileList) {\n      if (response) {\n        this.redisKey = response.data;\n      }\n    },\n    onLoadSuccess: function onLoadSuccess() {\n      var _this = this;\n\n      this.loading = true;\n      var filter = {\n        \"redisKey\": this.redisKey,\n        \"isSuccess\": true\n      };\n      checkpassdata(this.passPage.currentPage, this.passPage.pageSize, filter).then(function (res) {\n        var data = res.data.data;\n        _this.passPage.total = data.total;\n        _this.dataSuccess = data.records;\n        console.log(_this.dataSuccess);\n        _this.loading = false;\n      });\n    },\n    handlePassSizeChange: function handlePassSizeChange(size) {\n      this.passPage.pageSize = size;\n      this.onLoadSuccess();\n    },\n    handlePassCurrentChange: function handlePassCurrentChange(page) {\n      this.passPage.currentPage = page;\n      this.onLoadSuccess();\n    },\n    onLoadFail: function onLoadFail() {\n      var _this2 = this;\n\n      this.loading = true;\n      var filter = {\n        \"redisKey\": this.redisKey,\n        \"isSuccess\": false\n      };\n      checkpassdata(this.failPage.currentPage, this.failPage.pageSize, filter).then(function (res) {\n        var data = res.data.data;\n        _this2.failPage.total = data.total;\n        _this2.dataFail = data.records;\n        _this2.loading = false;\n      });\n    },\n    handleFailSizeChange: function handleFailSizeChange(size) {\n      this.failPage.pageSize = size;\n      this.onLoadFail();\n    },\n    handleFailCurrentChange: function handleFailCurrentChange(page) {\n      this.failPage.currentPage = page;\n      this.onLoadFail();\n    },\n    submitpassdata: function submitpassdata() {\n      var _this3 = this;\n\n      this.loading = true;\n      var filter = {\n        \"redisKey\": this.redisKey\n      };\n\n      _submitpassdata(filter).then(function (res) {\n        _this3.submitPassNum = res.data.data;\n      }, function (error) {\n        window.console.log(error);\n      });\n    },\n    next: function next(step) {\n      this.activeStep = step;\n\n      if (step == 3 && this.passPage.total != 0) {\n        this.submitpassdata();\n      }\n    }\n  }\n};",{"version":3,"sources":["uploadUserDialog.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4HA,SAAA,aAAA,EAAA,cAAA,IAAA,eAAA,QAAA,kCAAA;AACA,OAAA,OAAA,MAAA,kBAAA;AACA,SAAA,QAAA,QAAA,aAAA;AAEA,eAAA;AACA,EAAA,IAAA,EAAA,oBADA;AAEA,EAAA,KAAA,EAAA;AACA,IAAA,oBAAA,EAAA;AACA,MAAA,IAAA,EAAA,OADA;AAEA,MAAA,OAAA,EAAA;AAFA;AADA,GAFA;AAQA,EAAA,IARA,kBAQA;AACA,WAAA;AACA,MAAA,OAAA,EAAA,KADA;AAEA,MAAA,UAAA,EAAA,CAFA;AAGA,MAAA,QAAA,EAAA,EAHA;AAIA,MAAA,SAAA,EAAA;AACA,yCAAA,MAAA,CAAA,MAAA,WAAA,OAAA,CAAA,QAAA,cAAA,OAAA,CAAA,YAAA,EAAA,CADA;AAEA,yBAAA,YAAA,QAAA,EAFA;AAGA,sBAAA,YAAA,QAAA;AAHA,OAJA;AAQA;AACA,MAAA,QAAA,EAAA;AACA,QAAA,QAAA,EAAA,EADA;AAEA,QAAA,WAAA,EAAA,CAFA;AAGA,QAAA,KAAA,EAAA;AAHA,OATA;AAcA,MAAA,QAAA,EAAA;AACA,QAAA,QAAA,EAAA,EADA;AAEA,QAAA,WAAA,EAAA,CAFA;AAGA,QAAA,KAAA,EAAA;AAHA,OAdA;AAmBA,MAAA,WAAA,EAAA,CAAA;AACA,QAAA,QAAA,EAAA,IADA;AAEA,QAAA,YAAA,EAAA,eAFA;AAGA,QAAA,aAAA,EAAA,SAHA;AAIA,QAAA,kBAAA,EAAA,gBAJA;AAKA,QAAA,YAAA,EAAA,MALA;AAMA,QAAA,SAAA,EAAA;AANA,OAAA,CAnBA;AA2BA,MAAA,QAAA,EAAA,CAAA;AACA,QAAA,QAAA,EAAA,IADA;AAEA,QAAA,YAAA,EAAA,eAFA;AAGA,QAAA,aAAA,EAAA,SAHA;AAIA,QAAA,kBAAA,EAAA,gBAJA;AAKA,QAAA,YAAA,EAAA,MALA;AAMA,QAAA,GAAA,EAAA;AANA,OAAA,CA3BA;AAmCA,MAAA,aAAA,EAAA;AACA,QAAA,UAAA,EAAA,GADA;AAEA,QAAA,UAAA,EAAA,IAFA;AAGA,QAAA,cAAA,EAAA,CAHA;AAIA,QAAA,MAAA,EAAA,IAJA;AAKA,QAAA,KAAA,EAAA,KALA;AAMA,QAAA,OAAA,EAAA,KANA;AAOA,QAAA,MAAA,EAAA,KAPA;AAQA,QAAA,UAAA,EAAA,KARA;AASA,QAAA,SAAA,EAAA,KATA;AAUA,QAAA,IAAA,EAAA,KAVA;AAWA,QAAA,MAAA,EAAA,CAAA;AACA,UAAA,KAAA,EAAA,IADA;AAEA,UAAA,IAAA,EAAA;AAFA,SAAA,EAIA;AACA,UAAA,KAAA,EAAA,IADA;AAEA,UAAA,IAAA,EAAA;AAFA,SAJA,EAQA;AACA,UAAA,KAAA,EAAA,MADA;AAEA,UAAA,IAAA,EAAA;AAFA,SARA,EAWA;AACA,UAAA,KAAA,EAAA,MADA;AAEA,UAAA,IAAA,EAAA;AAFA,SAXA,EAcA;AACA,UAAA,KAAA,EAAA,MADA;AAEA,UAAA,IAAA,EAAA;AAFA,SAdA;AAXA,OAnCA;AAiEA,MAAA,UAAA,EAAA;AACA,QAAA,UAAA,EAAA,GADA;AAEA,QAAA,UAAA,EAAA,IAFA;AAGA,QAAA,cAAA,EAAA,CAHA;AAIA,QAAA,MAAA,EAAA,IAJA;AAKA,QAAA,KAAA,EAAA,KALA;AAMA,QAAA,OAAA,EAAA,KANA;AAOA,QAAA,MAAA,EAAA,KAPA;AAQA,QAAA,UAAA,EAAA,KARA;AASA,QAAA,SAAA,EAAA,KATA;AAUA,QAAA,IAAA,EAAA,KAVA;AAWA,QAAA,MAAA,EAAA,CAAA;AACA,UAAA,KAAA,EAAA,IADA;AAEA,UAAA,IAAA,EAAA;AAFA,SAAA,EAIA;AACA,UAAA,KAAA,EAAA,IADA;AAEA,UAAA,IAAA,EAAA;AAFA,SAJA,EAQA;AACA,UAAA,KAAA,EAAA,MADA;AAEA,UAAA,IAAA,EAAA;AAFA,SARA,EAWA;AACA,UAAA,KAAA,EAAA,MADA;AAEA,UAAA,IAAA,EAAA;AAFA,SAXA,EAcA;AACA,UAAA,KAAA,EAAA,MADA;AAEA,UAAA,IAAA,EAAA;AAFA,SAdA,EAkBA;AACA,UAAA,KAAA,EAAA,MADA;AAEA,UAAA,IAAA,EAAA;AAFA,SAlBA;AAXA,OAjEA;AAoGA,MAAA,QAAA,EAAA,EApGA;AAqGA,MAAA,aAAA,EAAA,CArGA;AAsGA,MAAA,WAAA,EAAA,IAAA,IAAA,GAAA;AAtGA,KAAA;AAwGA,GAjHA;AAkHA,EAAA,OAlHA,qBAkHA,CACA,CAnHA;AAoHA,EAAA,OAAA,EAAA;AACA,IAAA,aADA,yBACA,IADA,EACA;AACA,UAAA,IAAA,IAAA,IAAA,CAAA,IAAA,GAAA,KAAA,WAAA,EAAA;AACA,aAAA,QAAA,CAAA,KAAA,CAAA,uCAAA;AACA,aAAA,QAAA,GAAA,EAAA;AACA,eAAA,KAAA;AACA;;AACA,aAAA,IAAA;AACA,KARA;AASA,IAAA,mBATA,iCASA;AACA;AACA,MAAA,MAAA,CAAA,IAAA,mEAAA,OAAA,CAAA,WAAA,cAAA,QAAA,EAAA,kBAAA,KAAA,QAAA;AAEA,KAbA;AAcA,IAAA,cAdA,4BAcA;AACA,MAAA,MAAA,CAAA,IAAA,mEAAA,OAAA,CAAA,WAAA,cAAA,QAAA,EAAA;AAEA,KAjBA;AAkBA,IAAA,WAlBA,yBAkBA;AACA,WAAA,IAAA,CAAA,CAAA;AACA,WAAA,KAAA,CAAA,wBAAA;AACA,KArBA;AAsBA,IAAA,YAtBA,wBAsBA,QAtBA,EAsBA,IAtBA,EAsBA,QAtBA,EAsBA;AACA,UAAA,QAAA,EAAA;AACA,aAAA,QAAA,GAAA,QAAA,CAAA,IAAA;AACA;AACA,KA1BA;AA2BA,IAAA,aA3BA,2BA2BA;AAAA;;AACA,WAAA,OAAA,GAAA,IAAA;AACA,UAAA,MAAA,GAAA;AACA,oBAAA,KAAA,QADA;AAEA,qBAAA;AAFA,OAAA;AAIA,MAAA,aAAA,CAAA,KAAA,QAAA,CAAA,WAAA,EAAA,KAAA,QAAA,CAAA,QAAA,EAAA,MAAA,CAAA,CAAA,IAAA,CAAA,UAAA,GAAA,EAAA;AACA,YAAA,IAAA,GAAA,GAAA,CAAA,IAAA,CAAA,IAAA;AACA,QAAA,KAAA,CAAA,QAAA,CAAA,KAAA,GAAA,IAAA,CAAA,KAAA;AACA,QAAA,KAAA,CAAA,WAAA,GAAA,IAAA,CAAA,OAAA;AACA,QAAA,OAAA,CAAA,GAAA,CAAA,KAAA,CAAA,WAAA;AACA,QAAA,KAAA,CAAA,OAAA,GAAA,KAAA;AACA,OANA;AAOA,KAxCA;AAyCA,IAAA,oBAzCA,gCAyCA,IAzCA,EAyCA;AACA,WAAA,QAAA,CAAA,QAAA,GAAA,IAAA;AACA,WAAA,aAAA;AACA,KA5CA;AA6CA,IAAA,uBA7CA,mCA6CA,IA7CA,EA6CA;AACA,WAAA,QAAA,CAAA,WAAA,GAAA,IAAA;AACA,WAAA,aAAA;AACA,KAhDA;AAiDA,IAAA,UAjDA,wBAiDA;AAAA;;AACA,WAAA,OAAA,GAAA,IAAA;AACA,UAAA,MAAA,GAAA;AACA,oBAAA,KAAA,QADA;AAEA,qBAAA;AAFA,OAAA;AAIA,MAAA,aAAA,CAAA,KAAA,QAAA,CAAA,WAAA,EAAA,KAAA,QAAA,CAAA,QAAA,EAAA,MAAA,CAAA,CAAA,IAAA,CAAA,UAAA,GAAA,EAAA;AACA,YAAA,IAAA,GAAA,GAAA,CAAA,IAAA,CAAA,IAAA;AACA,QAAA,MAAA,CAAA,QAAA,CAAA,KAAA,GAAA,IAAA,CAAA,KAAA;AACA,QAAA,MAAA,CAAA,QAAA,GAAA,IAAA,CAAA,OAAA;AACA,QAAA,MAAA,CAAA,OAAA,GAAA,KAAA;AACA,OALA;AAMA,KA7DA;AA8DA,IAAA,oBA9DA,gCA8DA,IA9DA,EA8DA;AACA,WAAA,QAAA,CAAA,QAAA,GAAA,IAAA;AACA,WAAA,UAAA;AACA,KAjEA;AAkEA,IAAA,uBAlEA,mCAkEA,IAlEA,EAkEA;AACA,WAAA,QAAA,CAAA,WAAA,GAAA,IAAA;AACA,WAAA,UAAA;AACA,KArEA;AAsEA,IAAA,cAtEA,4BAsEA;AAAA;;AACA,WAAA,OAAA,GAAA,IAAA;AACA,UAAA,MAAA,GAAA;AAAA,oBAAA,KAAA;AAAA,OAAA;;AACA,MAAA,eAAA,CAAA,MAAA,CAAA,CAAA,IAAA,CAAA,UAAA,GAAA,EAAA;AACA,QAAA,MAAA,CAAA,aAAA,GAAA,GAAA,CAAA,IAAA,CAAA,IAAA;AACA,OAFA,EAEA,UAAA,KAAA,EAAA;AACA,QAAA,MAAA,CAAA,OAAA,CAAA,GAAA,CAAA,KAAA;AACA,OAJA;AAKA,KA9EA;AA+EA,IAAA,IA/EA,gBA+EA,IA/EA,EA+EA;AACA,WAAA,UAAA,GAAA,IAAA;;AACA,UAAA,IAAA,IAAA,CAAA,IAAA,KAAA,QAAA,CAAA,KAAA,IAAA,CAAA,EAAA;AACA,aAAA,cAAA;AACA;AACA;AApFA;AApHA,CAAA","sourcesContent":["<!--导入的弹窗-->\r\n<template>\r\n  <el-dialog\r\n    title=\"批量导入\"\r\n    :visible.sync=\"uploadUserDialogFlag\"\r\n    @close=\"closeDialog\"\r\n  >\r\n    <basic-container>\r\n      <el-steps :active=\"activeStep\" align-center>\r\n        <el-step title=\"上传文件\"></el-step>\r\n        <el-step title=\"数据校验\"></el-step>\r\n        <el-step title=\"数据入库\"></el-step>\r\n      </el-steps>\r\n      <template>\r\n        <div class=\"el-import-step\" v-if=\"activeStep==1\">\r\n          <div class=\"el-import-step-download\">\r\n            <div class=\"el-import-step-download-icon\">\r\n              <i class=\"el-icon-download\"></i>\r\n            </div>\r\n            <div class=\"el-import-step-download-desc\">\r\n              <div>导入模板文件下载</div>\r\n              <div class=\"download-tip\">请按照数据模板的格式准备导入数据，模板中的表头名称不可更改，表头行不能删除</div>\r\n              <div>\r\n                <el-link type=\"primary\" :underline=\"false\" @click=\"exportTemplate\">下载模板</el-link>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"el-import-step-download\">\r\n            <div class=\"el-import-step-download-icon\">\r\n              <i class=\"el-icon-upload\"></i>\r\n            </div>\r\n            <div class=\"el-import-step-download-desc\">\r\n              <div>上传填好的导入模板</div>\r\n              <div class=\"download-tip\">文件后缀名必须为xls或xlsx（即Excel格式），文件大小不得大于2M</div>\r\n              <el-upload\r\n                multiple\r\n                accept=\".xls, .xlsx\"\r\n                :headers=\"headerObj\"\r\n                action=\"/api/cnfic-contract-manage/orguser/importUserFile\"\r\n                :on-success=\"handleChange\"\r\n                :before-upload=\"checkFileSize\"\r\n                :file-list=\"fileList\">\r\n                <el-link type=\"primary\" :underline=\"false\">上传文件</el-link>\r\n              </el-upload>\r\n            </div>\r\n          </div>\r\n          <div class=\"el-import-step-footer\">\r\n            <el-button size=\"small\" type=\"primary\" @click=\"next(2)\">&nbsp;&nbsp;&nbsp;下一步&nbsp;&nbsp;&nbsp;</el-button>\r\n            <el-button size=\"small\" @click=\"closeDialog\">&nbsp;&nbsp;&nbsp;取&nbsp;&nbsp;&nbsp;消&nbsp;&nbsp;&nbsp;\r\n            </el-button>\r\n          </div>\r\n        </div>\r\n        <div class=\"el-import-step\" v-if=\"activeStep==2\">\r\n          <avue-crud\r\n            :option=\"optionSuccess\"\r\n            :table-loading=\"loading\"\r\n            :page.sync=\"passPage\"\r\n            :data=\"dataSuccess\"\r\n            @on-load=\"onLoadSuccess\">\r\n            <template slot=\"header\">\r\n              <div class=\"el-import-list-header\">\r\n                校验成功数据列表\r\n                <el-link type=\"primary\" :underline=\"false\" size=\"small\">{{passPage.total}}条</el-link>\r\n              </div>\r\n            </template>\r\n          </avue-crud>\r\n          <div class=\"el-import-list-pagination\">\r\n            <el-pagination\r\n              background\r\n              @size-change=\"handlePassSizeChange\"\r\n              @current-change=\"handlePassCurrentChange\"\r\n              :current-page=\"passPage.currentPage\"\r\n              :page-size=\"passPage.pageSize\"\r\n              layout=\"total, sizes, prev, pager, next, jumper\"\r\n              :total=\"passPage.total\">\r\n            </el-pagination>\r\n          </div>\r\n          <avue-crud\r\n            :option=\"optionFail\"\r\n            :table-loading=\"loading\"\r\n            :page.sync=\"failPage\"\r\n            :data=\"dataFail\"\r\n            @on-load=\"onLoadFail\">\r\n            <template slot=\"header\">\r\n              <div class=\"el-import-list-header\">\r\n                校验失败数据列表\r\n                <el-link type=\"primary\" :underline=\"false\" size=\"small\">{{failPage.total}}条</el-link>\r\n                <el-link type=\"primary\" :underline=\"false\" size=\"small\" @click=\"exportCheckfaildata\">下载失败数据列表</el-link>\r\n              </div>\r\n            </template>\r\n          </avue-crud>\r\n          <div class=\"el-import-list-pagination\">\r\n            <el-pagination\r\n              background\r\n              @size-change=\"handleFailSizeChange\"\r\n              @current-change=\"handleFailCurrentChange\"\r\n              :current-page=\"failPage.currentPage\"\r\n              :page-size=\"failPage.pageSize\"\r\n              layout=\"total, sizes, prev, pager, next, jumper\"\r\n              :total=\"failPage.total\">\r\n            </el-pagination>\r\n          </div>\r\n          <div class=\"el-import-step-footer\">\r\n            <el-button size=\"small\" type=\"primary\" @click=\"next(1)\">返回重新上传</el-button>\r\n            <el-button size=\"small\" type=\"primary\" @click=\"next(3)\">忽略异常数据导入</el-button>\r\n            <el-button size=\"small\" @click=\"closeDialog\">&nbsp;&nbsp;&nbsp;取&nbsp;&nbsp;&nbsp;消&nbsp;&nbsp;&nbsp;\r\n            </el-button>\r\n          </div>\r\n        </div>\r\n        <div class=\"el-import-step\" v-if=\"activeStep==3\">\r\n          <div class=\"el-import-step-three\">\r\n            <div class=\"el-import-step-download-icon\"><i class=\"el-icon-success\"></i></div>\r\n            <h3>数据导入成功</h3>\r\n            <div class=\"download-tip\">导入数据{{submitPassNum}}条</div>\r\n          </div>\r\n          <div class=\"el-import-step-footer\">\r\n            <el-button size=\"small\" type=\"primary\" @click=\"closeDialog\">&nbsp;&nbsp;&nbsp;完&nbsp;&nbsp;&nbsp;成&nbsp;&nbsp;&nbsp;</el-button>\r\n          </div>\r\n        </div>\r\n      </template>\r\n    </basic-container>\r\n  </el-dialog>\r\n</template>\r\n<script>\r\n  import {checkpassdata, submitpassdata} from \"@/api/contract/user/personaluser\";\r\n  import website from \"@/config/website\";\r\n  import {getToken} from '@/util/auth';\r\n\r\n  export default {\r\n    name: \"upload-user-dialog\",\r\n    props: {\r\n      uploadUserDialogFlag: {\r\n        type: Boolean,\r\n        default: false\r\n      }\r\n    },\r\n    data() {\r\n      return {\r\n        loading: false,\r\n        activeStep: 1,\r\n        fileList: [],\r\n        headerObj: {\r\n          \"Authorization\": `Basic ${Base64.encode(`${website.clientId}:${website.clientSecret}`)}`,\r\n          \"TongTech-Auth\": 'Bearer ' + getToken(),\r\n          \"Blade-Auth\": 'Bearer ' + getToken()\r\n        },//附件上传请求头参数\r\n        passPage: {\r\n          pageSize: 10,\r\n          currentPage: 1,\r\n          total: 0\r\n        },\r\n        failPage: {\r\n          pageSize: 10,\r\n          currentPage: 1,\r\n          total: 0\r\n        },\r\n        dataSuccess: [{\r\n          custName: '张三',\r\n          custTypeName: '利率债_金融债_IBABS',\r\n          custStateName: 'XHCJ001',\r\n          businessChanceName: '中央国债登记结算有限责任公司',\r\n          businessDesc: '行情数据',\r\n          repeatTip: '提示信息',\r\n        }],\r\n        dataFail: [{\r\n          custName: '张三',\r\n          custTypeName: '利率债_金融债_IBABS',\r\n          custStateName: 'XHCJ001',\r\n          businessChanceName: '中央国债登记结算有限责任公司',\r\n          businessDesc: '行情数据',\r\n          msg:\"\",\r\n        }],\r\n        optionSuccess: {\r\n          calcHeight: 100,\r\n          searchShow: true,\r\n          searchMenuSpan: 6,\r\n          border: true,\r\n          index: false,\r\n          viewBtn: false,\r\n          addBtn: false,\r\n          refreshBtn: false,\r\n          columnBtn: false,\r\n          menu: false,\r\n          column: [{\r\n            label: '部门',\r\n            prop: 'custOrg'\r\n          },\r\n            {\r\n              label: '邮箱',\r\n              prop: 'userEmail'\r\n            },\r\n            {\r\n              label: '用户描述',\r\n              prop: 'userDesc'\r\n            }, {\r\n              label: '用户类型',\r\n              prop: 'userTypeName'\r\n            }, {\r\n              label: '客户经理',\r\n              prop: 'custManagerName'\r\n            }]\r\n        },\r\n        optionFail: {\r\n          calcHeight: 210,\r\n          searchShow: true,\r\n          searchMenuSpan: 6,\r\n          border: true,\r\n          index: false,\r\n          viewBtn: false,\r\n          addBtn: false,\r\n          refreshBtn: false,\r\n          columnBtn: false,\r\n          menu: false,\r\n          column: [{\r\n            label: '部门',\r\n            prop: 'custOrg'\r\n          },\r\n            {\r\n              label: '邮箱',\r\n              prop: 'userEmail'\r\n            },\r\n            {\r\n              label: '用户描述',\r\n              prop: 'userDesc'\r\n            }, {\r\n              label: '用户类型',\r\n              prop: 'userTypeName'\r\n            }, {\r\n              label: '客户经理',\r\n              prop: 'custManagerName'\r\n            },\r\n            {\r\n              label: '错误提示',\r\n              prop: 'failMsg'\r\n            }\r\n          ]\r\n        },\r\n        redisKey: \"\",\r\n        submitPassNum: 0,\r\n        fileMaxSize: 2 * 1024 * 1024,\r\n      }\r\n    },\r\n    mounted() {\r\n    },\r\n    methods: {\r\n      checkFileSize(file) {\r\n        if (file && file.size > this.fileMaxSize) {\r\n          this.$message.error('文件后缀名必须为xls或xlsx（即Excel格式），文件大小不得大于2M');\r\n          this.fileList = [];\r\n          return false;\r\n        }\r\n        return true;\r\n      },\r\n      exportCheckfaildata() {\r\n        // window.open(`/api/cnfic-contract-manage/blackwhitelist/export-checkfaildata?${website.tokenHeader}=${getToken()}&failRedisKey=${this.failRedisKey}`);\r\n        window.open(`/api/cnfic-contract-manage/orguser/downloadUserTemplate?${website.tokenHeader}=${getToken()}&key=${this.redisKey}`);\r\n\r\n      },\r\n      exportTemplate() {\r\n        window.open(`/api/cnfic-contract-manage/orguser/downloadUserTemplate?${website.tokenHeader}=${getToken()}`);\r\n\r\n      },\r\n      closeDialog() {\r\n        this.next(1);\r\n        this.$emit(\"cancelUploadUserDialog\");\r\n      },\r\n      handleChange(response, file, fileList) {\r\n        if (response) {\r\n          this.redisKey = response.data;\r\n        }\r\n      },\r\n      onLoadSuccess() {\r\n        this.loading = true;\r\n        const filter = {\r\n          \"redisKey\": this.redisKey,\r\n          \"isSuccess\": true,\r\n        };\r\n        checkpassdata(this.passPage.currentPage, this.passPage.pageSize, filter).then(res => {\r\n          const data = res.data.data;\r\n          this.passPage.total = data.total;\r\n          this.dataSuccess = data.records;\r\n          console.log(this.dataSuccess)\r\n          this.loading = false;\r\n        });\r\n      },\r\n      handlePassSizeChange(size) {\r\n        this.passPage.pageSize = size;\r\n        this.onLoadSuccess();\r\n      },\r\n      handlePassCurrentChange(page) {\r\n        this.passPage.currentPage = page;\r\n        this.onLoadSuccess();\r\n      },\r\n      onLoadFail() {\r\n        this.loading = true;\r\n        const filter = {\r\n          \"redisKey\": this.redisKey,\r\n          \"isSuccess\": false,\r\n        };\r\n        checkpassdata(this.failPage.currentPage, this.failPage.pageSize, filter).then(res => {\r\n          const data = res.data.data;\r\n          this.failPage.total = data.total;\r\n          this.dataFail = data.records;\r\n          this.loading = false;\r\n        });\r\n      },\r\n      handleFailSizeChange(size) {\r\n        this.failPage.pageSize = size;\r\n        this.onLoadFail();\r\n      },\r\n      handleFailCurrentChange(page) {\r\n        this.failPage.currentPage = page;\r\n        this.onLoadFail();\r\n      },\r\n      submitpassdata() {\r\n        this.loading = true;\r\n        const filter = {\"redisKey\": this.redisKey};\r\n        submitpassdata(filter).then(res => {\r\n          this.submitPassNum = res.data.data;\r\n        }, error => {\r\n          window.console.log(error);\r\n        });\r\n      },\r\n      next(step) {\r\n        this.activeStep = step;\r\n        if (step == 3 && this.passPage.total != 0) {\r\n          this.submitpassdata();\r\n        }\r\n      }\r\n    }\r\n  }\r\n</script>\r\n<style lang=\"scss\">\r\n  .el-import-step {\r\n    margin-top: 1rem;\r\n    width: 100%;\r\n    &-download:first-child {\r\n      border-bottom: 1px solid #d9d9db;\r\n    }\r\n    &-download {\r\n      width: 100%;\r\n      display: flex;\r\n      justify-content: center;\r\n      align-items: center;\r\n      padding: 1rem 0;\r\n      &-icon {\r\n        i {\r\n          color: #078ecf;\r\n          font-size: 40px;\r\n          padding: 0 30px;\r\n        }\r\n      }\r\n      &-desc {\r\n        width: 70%;\r\n        div {\r\n          padding: 5px 0;\r\n        }\r\n        div:first-child {\r\n          font-size: 14px;\r\n        }\r\n        .el-link.el-link--primary {\r\n          color: #078ecf;\r\n        }\r\n        .download-tip {\r\n          font-size: 12px;\r\n          color: #9da7b0;\r\n        }\r\n      }\r\n    }\r\n    &-footer {\r\n      text-align: center;\r\n      width: 100%;\r\n      margin-top: 1rem;\r\n      .el-button--small {\r\n        margin: 0 1rem;\r\n      }\r\n    }\r\n    &-three {\r\n      text-align: center;\r\n      h3, div {\r\n        width: 100%;\r\n      }\r\n    }\r\n    .avue-crud__menu {\r\n      min-height: 30px;\r\n    }\r\n    .avue-crud__pagination {\r\n      display: none;\r\n    }\r\n    .el-import-list-header {\r\n      height: 40px;\r\n      line-height: 40px;\r\n      font-size: 14px;\r\n      color: #9da7b0;\r\n      .el-link {\r\n        vertical-align: initial;\r\n      }\r\n      a {\r\n        color: #078ecf;\r\n        margin: 0 10px;\r\n      }\r\n    }\r\n    .el-import-list-pagination {\r\n      text-align: center;\r\n      width: 100%;\r\n      margin-top: 1rem;\r\n    }\r\n  }\r\n</style>\r\n"],"sourceRoot":"src/views/contract/user"}]}