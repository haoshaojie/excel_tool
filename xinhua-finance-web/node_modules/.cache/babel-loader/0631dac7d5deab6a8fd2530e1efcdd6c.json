{"remainingRequest":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\babel-loader\\lib\\index.js!F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\src\\views\\contract\\product\\productItem\\productitem-add.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\src\\views\\contract\\product\\productItem\\productitem-add.vue","mtime":1618541026430},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es7.symbol.async-iterator\";\nimport \"core-js/modules/es6.symbol\";\nimport \"core-js/modules/es6.array.from\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport _defineProperty from \"F:/\\u4E1C\\u65B9\\u901A/source/b_zwj/xinhua-finance-web/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport \"core-js/modules/es6.string.link\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.string.iterator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { add, getDetail, update } from \"@/api/contract/product/productitem\";\nimport baseInfo from \"./baseInfo\";\nimport extendInfo from \"./extendInfo\";\nimport profitInfo from \"../components/profitInfo\";\nimport picInfo from \"../components/picInfo\";\nimport priceInfo from \"../components/priceInfo\";\nexport default {\n  name: \"productitem-add\",\n  components: {\n    baseInfo: baseInfo,\n    extendInfo: extendInfo,\n    priceInfo: priceInfo,\n    picInfo: picInfo,\n    profitInfo: profitInfo\n  },\n  props: {\n    id: '',\n    title: \"新增\",\n    isView: false\n  },\n  data: function data() {\n    return {\n      activeName: 'baseInfo',\n      headers: {},\n      loading: false,\n      btnState: false,\n      picFiles: [],\n      form: {\n        baseInfo: {\n          propCode: '',\n          propName: '',\n          propDept: '',\n          cateId: '',\n          releaseScope: '',\n          prodId: '',\n          prodIds: [],\n          addedDate: '',\n          expiredDate: '',\n          itemState: ''\n        },\n        extendInfo: {\n          itemValues: []\n        },\n        priceInfo: {\n          isValuation: 2,\n          valuation: []\n        },\n        picInfo: {\n          itemDesc: '',\n          proImage: '',\n          fileLists: [],\n          dialogImageUrl: '',\n          dialogVisible: false\n        },\n        profitInfo: {\n          partnerId: '',\n          profitRates: [],\n          itemSourse: 1,\n          shareType: '',\n          shareResult: ''\n        }\n      }\n    };\n  },\n  mounted: function mounted() {\n    this.$refs['priceInfo'].productType = 2;\n    this.$refs['picInfo'].productType = 2;\n    this.$refs['profitInfo'].productType = 2;\n\n    if (this.id) {\n      if (this.isView) {\n        this.title = \"详情\";\n      } else {\n        this.title = \"编辑\";\n      }\n\n      this.detail();\n    } else {\n      this.title = \"新增\";\n    }\n  },\n  methods: {\n    detail: function detail() {\n      var _this2 = this;\n\n      var _this = this;\n\n      this.loading = true;\n      getDetail(_this.id).then(function (res) {\n        console.log(res.data.data);\n        _this2.loading = false;\n\n        if (res.data.data) {\n          if (res.data.data.itemState == 1) {\n            _this2.btnState = true;\n          }\n\n          _this.$refs[\"baseInfo\"].showData(res.data.data);\n\n          _this.$refs[\"extendInfo\"].showData(res.data.data);\n\n          _this.$refs[\"priceInfo\"].showData(res.data.data);\n\n          _this.$refs[\"picInfo\"].showData(res.data.data);\n\n          _this.$refs[\"profitInfo\"].showData(res.data.data);\n        }\n      });\n    },\n    save: function save(itemState) {\n      var _this3 = this;\n\n      var validForms = [];\n\n      var _this = this;\n\n      validForms.push({\n        page: \"baseInfo\",\n        formName: 'draftForm'\n      });\n\n      if (itemState < 4 || itemState == 5) {\n        validForms.push({\n          page: \"baseInfo\",\n          formName: 'baseForm'\n        }, {\n          page: \"extendInfo\",\n          formName: 'extendForm'\n        }, {\n          page: \"priceInfo\",\n          formName: 'priceForm'\n        }, {\n          page: \"priceInfo\",\n          formName: 'inServForm'\n        }, {\n          page: \"profitInfo\",\n          formName: 'profitForm'\n        });\n\n        if (this.$refs['profitInfo'].$refs['ratesForm']) {\n          //保存暂不上架和保存并上架校验全部表单 //阶梯比例表单没显示时不校验该表单\n          validForms.push({\n            page: \"profitInfo\",\n            formName: \"ratesForm\"\n          });\n        }\n      }\n\n      Promise.all(validForms.map(function (_ref) {\n        var page = _ref.page,\n            formName = _ref.formName;\n        return _this3.$refs[page].$refs[formName].validate();\n      })).then(function () {\n        if (_this.form.picInfo.fileLists) {\n          _this.form.picInfo.fileLists.forEach(function (file) {\n            if (file.id) {\n              _this3.picFiles.push({\n                imageUrl: file.url,\n                fileName: file.name,\n                fileSize: file.fileSize\n              });\n            } else {\n              var data = file.response.data;\n\n              _this3.picFiles.push({\n                imageUrl: data.link,\n                fileName: data.originalName,\n                fileSize: file.size\n              });\n            }\n          });\n\n          _this.form.picInfo.fileList = _this3.picFiles;\n        }\n\n        if (_this.form.priceInfo && _this.form.priceInfo.isValuation == 1) {\n          // 存在计价属性\n          var priceInfoStr = \"|\";\n          _this.form.priceInfo.valuations = [];\n\n          var _iterator = _createForOfIteratorHelper(_this.form.priceInfo.valuation),\n              _step;\n\n          try {\n            for (_iterator.s(); !(_step = _iterator.n()).done;) {\n              var info = _step.value;\n              // 判断是否都为空 为空则不存入数据库\n              var b = true; // 为false 说明全部为空 从列表中删除 ;true 不为空 \n\n              if (info.currency == '' && info.standardPrice == '' && info.promotionPrice == '') {\n                // 三个常列为空\n                b = false;\n\n                if (info.valuationValue.length != 0) {\n                  // // 有扩展列\n                  for (var i = 0; i < info.valuationValue.length; i++) {\n                    if (info.valuationValue[i].propValue != '') {\n                      // 扩展列有值\n                      b = true;\n                      break;\n                    }\n                  }\n                }\n              }\n\n              if (b) {\n                // 判断当前\n                var infoStr = JSON.stringify(info);\n                console.log(priceInfoStr, priceInfoStr.includes('|' + infoStr + '|'));\n\n                if (priceInfoStr != '|' && priceInfoStr.includes('|' + infoStr + '|')) {\n                  _this3.$message({\n                    type: \"warning\",\n                    message: \"计价属性存在完全一致的数据，请核对!\"\n                  });\n\n                  return false;\n                } else {\n                  priceInfoStr += infoStr + '|';\n\n                  _this.form.priceInfo.valuations.push({\n                    valuationValues: JSON.stringify(info.valuationValue),\n                    currency: info.currency,\n                    promotionPrice: info.promotionPrice,\n                    standardPrice: info.promotionPrice\n                  });\n                }\n              }\n            }\n          } catch (err) {\n            _iterator.e(err);\n          } finally {\n            _iterator.f();\n          }\n\n          if (_this.form.priceInfo.valuations.length <= 0) {\n            _this3.$message({\n              type: \"warning\",\n              message: \"请最少输入一条计价信息!\"\n            });\n\n            return false;\n          }\n        }\n\n        if (_this.form.baseInfo.prodIds.length > 0) {\n          _this.form.baseInfo.prodId = _this.form.baseInfo.prodIds.join('|');\n        }\n\n        console.log(_this.form.baseInfo.prodId);\n\n        var params = _objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread({}, _this.form.baseInfo), _this.form.extendInfo), _this.form.priceInfo), _this.form.picInfo), _this.form.profitInfo);\n\n        if (itemState != 5) {\n          params.itemState = itemState;\n        }\n\n        _this3.loading = true;\n        console.log(123, params);\n\n        if (_this3.id) {\n          update(params).then(function (res) {\n            _this3.loading = false;\n\n            _this3.$message.success(res.data.msg);\n\n            _this3.goBack();\n          });\n        } else {\n          add(params).then(function (res) {\n            _this3.loading = false;\n\n            _this3.$message.success(res.data.msg);\n\n            _this3.goBack();\n          });\n        }\n      }).catch(function () {\n        //校验失败\n        console.log(\"error\");\n      });\n    },\n    goBack: function goBack() {\n      this.$emit(\"back\"); // this.$router.go(-1);\n    }\n  }\n};",{"version":3,"sources":["productitem-add.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <basic-container>\r\n    <template>\r\n      <el-row>\r\n        <el-col :span=\"16\">\r\n          <el-page-header @back=\"goBack\" :content=\"title\" class=\"header\">\r\n          </el-page-header>\r\n        </el-col>\r\n        <el-col :span=\"8\">\r\n          <el-row v-if=\"!isView\" style='float:right'>\r\n            <el-button size=\"small\" v-if=\"!btnState\" type=\"primary\" @click.native=\"save(4)\">保存至草稿</el-button>\r\n            <el-button size=\"small\" v-if=\"!btnState\" @click.native=\"save(3)\">保存暂不上架</el-button>\r\n            <el-button size=\"small\" v-if=\"!btnState\" type=\"primary\" @click.native=\"save(1)\">保存并上架</el-button>\r\n            <el-button size=\"small\" v-if=\"btnState\" type=\"primary\" @click.native=\"save(5)\">保存</el-button>\r\n          </el-row>\r\n        </el-col>\r\n      </el-row>\r\n    </template>\r\n    <template>\r\n      <el-tabs v-model=\"activeName\" @tab-click=\"handleClick\">\r\n        <el-tab-pane label=\"基础信息\" name=\"baseInfo\">\r\n          <baseInfo ref=\"baseInfo\" :baseInfo=\"form.baseInfo\" :is-view=\"isView\"></baseInfo>\r\n        </el-tab-pane>\r\n        <el-tab-pane label=\"扩展信息\" name=\"extendInfo\">\r\n           <extendInfo ref=\"extendInfo\" :extendInfo=\"form.extendInfo\" :is-view=\"isView\"></extendInfo>\r\n        </el-tab-pane>\r\n        <el-tab-pane label=\"计价设置\" name=\"priceInfo\">\r\n          <priceInfo ref=\"priceInfo\" :priceInfo=\"form.priceInfo\" :is-view=\"isView\"></priceInfo>\r\n        </el-tab-pane>\r\n        <el-tab-pane label=\"图文信息\" name=\"picInfo\" >\r\n          <pic-info ref=\"picInfo\" :picInfo=\"form.picInfo\" :is-view=\"isView\"></pic-info>\r\n        </el-tab-pane>\r\n        <el-tab-pane label=\"分润信息\" name=\"profitInfo\">\r\n          <profitInfo ref=\"profitInfo\" :profitInfo=\"form.profitInfo\" :is-view=\"isView\"></profitInfo>\r\n        </el-tab-pane>\r\n      </el-tabs>\r\n    </template>\r\n  </basic-container>\r\n</template>\r\n<script>\r\nimport {add,getDetail,update} from \"@/api/contract/product/productitem\";\r\nimport baseInfo from \"./baseInfo\"\r\nimport extendInfo from \"./extendInfo\";\r\nimport profitInfo from \"../components/profitInfo\";\r\nimport picInfo from \"../components/picInfo\";\r\nimport priceInfo from \"../components/priceInfo\";\r\n\r\nexport default {\r\n  name:\"productitem-add\",\r\n  components:{baseInfo,extendInfo,priceInfo,picInfo,profitInfo},\r\n  props:{\r\n    id:'',\r\n    title:\"新增\",\r\n    isView:false\r\n  },\r\n  data(){\r\n    return {\r\n      activeName: 'baseInfo',\r\n      headers:{},\r\n      loading:false,\r\n      btnState:false,\r\n      picFiles:[],\r\n      form:{\r\n        baseInfo:{\r\n          propCode: '',\r\n          propName: '',\r\n          propDept: '',\r\n          cateId: '',\r\n          releaseScope: '',\r\n          prodId: '',\r\n          prodIds:[],\r\n          addedDate: '',\r\n          expiredDate: '',\r\n          itemState:''\r\n        },\r\n        extendInfo:{\r\n          itemValues:[]\r\n        },\r\n        priceInfo:{\r\n          isValuation:2,\r\n          valuation:[]\r\n        },\r\n        picInfo:{\r\n          itemDesc:'',\r\n          proImage:'',\r\n          fileLists:[],\r\n          dialogImageUrl: '',\r\n          dialogVisible: false\r\n        },\r\n        profitInfo:{\r\n          partnerId:'',\r\n          profitRates:[],\r\n          itemSourse: 1,\r\n          shareType: '',\r\n          shareResult:'' \r\n        }\r\n      }\r\n    }\r\n  },\r\n  mounted() {\r\n    this.$refs['priceInfo'].productType=2;\r\n    this.$refs['picInfo'].productType=2;\r\n    this.$refs['profitInfo'].productType=2;\r\n    if(this.id){\r\n      if(this.isView){\r\n        this.title=\"详情\";\r\n      }else{\r\n        this.title=\"编辑\";\r\n      }\r\n      this.detail();\r\n    }else{\r\n      this.title=\"新增\";\r\n    }\r\n  },\r\n  methods: {\r\n    detail(){\r\n      let _this = this\r\n      this.loading = true;\r\n      getDetail(_this.id).then(res =>{\r\n        console.log(res.data.data)\r\n        this.loading = false;\r\n        if(res.data.data){\r\n          if(res.data.data.itemState == 1){\r\n            this.btnState =true;\r\n          }\r\n          _this.$refs[\"baseInfo\"].showData(res.data.data);\r\n          _this.$refs[\"extendInfo\"].showData(res.data.data);\r\n          _this.$refs[\"priceInfo\"].showData(res.data.data);\r\n          _this.$refs[\"picInfo\"].showData(res.data.data);\r\n          _this.$refs[\"profitInfo\"].showData(res.data.data);\r\n        }\r\n      })\r\n    },\r\n    save(itemState) {\r\n      let validForms = [];\r\n      let _this = this;\r\n      validForms.push({page:\"baseInfo\", formName:'draftForm'})\r\n      if(itemState < 4 || itemState ==5){\r\n        validForms.push(\r\n            {page:\"baseInfo\", formName:'baseForm'},\r\n            {page:\"extendInfo\", formName:'extendForm'},\r\n            {page:\"priceInfo\", formName:'priceForm'},\r\n            {page:\"priceInfo\", formName:'inServForm'},\r\n            {page:\"profitInfo\", formName:'profitForm'}\r\n          )\r\n        if(this.$refs['profitInfo'].$refs['ratesForm']){\r\n          //保存暂不上架和保存并上架校验全部表单 //阶梯比例表单没显示时不校验该表单\r\n          validForms.push({page:\"profitInfo\",formName:\"ratesForm\"})\r\n        }\r\n      }\r\n      Promise.all(\r\n        validForms.map(({page,formName}) => {\r\n            return this.$refs[page].$refs[formName].validate();\r\n        })\r\n      ).then(() => {\r\n        if(_this.form.picInfo.fileLists){\r\n          _this.form.picInfo.fileLists.forEach(file =>{\r\n            if(file.id){\r\n              this.picFiles.push({imageUrl:file.url, fileName:file.name, fileSize:file.fileSize});\r\n            }else{\r\n              let data = file.response.data;\r\n              this.picFiles.push({imageUrl:data.link,fileName:data.originalName,fileSize:file.size});\r\n            }\r\n          })\r\n          _this.form.picInfo.fileList = this.picFiles;\r\n        }\r\n        if(_this.form.priceInfo && _this.form.priceInfo.isValuation ==1){ // 存在计价属性\r\n          let priceInfoStr=\"|\";\r\n          _this.form.priceInfo.valuations = [];\r\n          for(let info of _this.form.priceInfo.valuation){\r\n            // 判断是否都为空 为空则不存入数据库\r\n            let b = true; // 为false 说明全部为空 从列表中删除 ;true 不为空 \r\n            if(info.currency =='' && info.standardPrice =='' && info.promotionPrice ==''){// 三个常列为空\r\n              b=false\r\n              if(info.valuationValue.length != 0){ // // 有扩展列\r\n                for(var i=0; i<info.valuationValue.length; i++){\r\n                  if(info.valuationValue[i].propValue != ''){ // 扩展列有值\r\n                    b=true\r\n                    break;\r\n                  }\r\n                }\r\n              }\r\n            }\r\n            if(b){\r\n              // 判断当前\r\n              let infoStr = JSON.stringify(info);\r\n              console.log(priceInfoStr,priceInfoStr.includes('|'+infoStr+'|'))\r\n              if(priceInfoStr != '|' && priceInfoStr.includes('|'+infoStr+'|')){\r\n                this.$message({\r\n                  type: \"warning\",\r\n                  message: \"计价属性存在完全一致的数据，请核对!\"\r\n                });\r\n                return false;\r\n              }else{\r\n                priceInfoStr += infoStr+'|'\r\n                _this.form.priceInfo.valuations.push({\r\n                  valuationValues:JSON.stringify(info.valuationValue),\r\n                  currency: info.currency,\r\n                  promotionPrice: info.promotionPrice,\r\n                  standardPrice: info.promotionPrice\r\n                })\r\n              }\r\n            }\r\n          }\r\n          if(_this.form.priceInfo.valuations.length<=0){\r\n            this.$message({\r\n              type: \"warning\",\r\n              message: \"请最少输入一条计价信息!\"\r\n            });\r\n            return false;\r\n          }\r\n        }\r\n        if(_this.form.baseInfo.prodIds.length>0){\r\n          _this.form.baseInfo.prodId=_this.form.baseInfo.prodIds.join('|')\r\n        }\r\n        console.log(_this.form.baseInfo.prodId)\r\n        let params = {..._this.form.baseInfo, ..._this.form.extendInfo, ..._this.form.priceInfo,\r\n         ..._this.form.picInfo, ..._this.form.profitInfo}\r\n        if(itemState!=5){\r\n          params.itemState = itemState;\r\n        }\r\n        this.loading = true;\r\n        console.log(123,params);\r\n        if(this.id){\r\n          update(params).then(res => {\r\n            this.loading = false;\r\n            this.$message.success(res.data.msg);\r\n            this.goBack();\r\n          });\r\n        }else{\r\n          add(params).then(res => {\r\n            this.loading = false;\r\n            this.$message.success(res.data.msg);\r\n            this.goBack();\r\n          });\r\n        }\r\n      }).catch(() => {\r\n        //校验失败\r\n        console.log(\"error\");\r\n      })\r\n    },\r\n    goBack() {\r\n      this.$emit(\"back\");\r\n      // this.$router.go(-1);\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style >\r\n  .header .el-page-header__content {\r\n    font-size: 14px;\r\n    font-weight: 500;\r\n    color: #303133;\r\n  }\r\n</style>\r\n"],"sourceRoot":"src/views/contract/product/productItem"}]}