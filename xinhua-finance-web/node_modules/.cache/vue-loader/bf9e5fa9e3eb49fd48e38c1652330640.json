{"remainingRequest":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\src\\views\\contract\\customer\\constractDialog.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\src\\views\\contract\\customer\\constractDialog.vue","mtime":1618541026412},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.el-import-step {\n  margin-top: 1rem;\n  width: 100%;\n  &-download:first-child {\n    border-bottom: 1px solid #d9d9db;\n  }\n  &-download {\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding: 1rem 0;\n    &-icon {\n      i {\n        color: #078ecf;\n        font-size: 40px;\n        padding: 0 30px;\n      }\n    }\n    &-desc {\n      width: 70%;\n      div {\n        padding: 5px 0;\n      }\n      div:first-child {\n        font-size: 14px;\n      }\n      .el-link.el-link--primary {\n        color: #078ecf;\n      }\n      .download-tip {\n        font-size: 12px;\n        color: #9da7b0;\n      }\n    }\n  }\n  &-footer {\n    text-align: center;\n    width: 100%;\n    margin-top: 1rem;\n    .el-button--small {\n      margin: 0 1rem;\n    }\n  }\n  &-three {\n    text-align: center;\n    h3, div {\n      width: 100%;\n    }\n  }\n  .avue-crud__menu {\n    min-height: 30px;\n  }\n  .avue-crud__pagination {\n    display: none;\n  }\n  .el-import-list-header {\n    height: 40px;\n    line-height: 40px;\n    font-size: 14px;\n    color: #9da7b0;\n    .el-link {\n      vertical-align: initial;\n    }\n    a {\n      color: #078ecf;\n      margin: 0 10px;\n    }\n  }\n  .el-import-list-pagination {\n    text-align: center;\n    width: 100%;\n    margin-top: 1rem;\n  }\n}\n",{"version":3,"sources":["constractDialog.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+UA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"constractDialog.vue","sourceRoot":"src/views/contract/customer","sourcesContent":["<!--导入的弹窗-->\r\n<template>\r\n  <el-dialog\r\n    title=\"批量导入\"\r\n    :visible.sync=\"constractDialogFlag\"\r\n    @close=\"closeDialog\"\r\n  >\r\n    <basic-container>\r\n      <el-steps :active=\"activeStep\" align-center>\r\n        <el-step title=\"上传文件\"></el-step>\r\n        <el-step title=\"数据校验\"></el-step>\r\n        <el-step title=\"数据入库\"></el-step>\r\n      </el-steps>\r\n      <template>\r\n        <div class=\"el-import-step\" v-if=\"activeStep==1\">\r\n          <div class=\"el-import-step-download\">\r\n            <div class=\"el-import-step-download-icon\">\r\n              <i class=\"el-icon-download\"></i>\r\n            </div>\r\n            <div class=\"el-import-step-download-desc\">\r\n              <div>导入模板文件下载</div>\r\n              <div class=\"download-tip\">请按照数据模板的格式准备导入数据，模板中的表头名称不可更改，表头行不能删除</div>\r\n              <div>\r\n                <el-link type=\"primary\" :underline=\"false\" @click=\"exportTemplate\">下载模板</el-link>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"el-import-step-download\">\r\n            <div class=\"el-import-step-download-icon\">\r\n              <i class=\"el-icon-upload\"></i>\r\n            </div>\r\n            <div class=\"el-import-step-download-desc\">\r\n              <div>上传填好的导入模板</div>\r\n              <div class=\"download-tip\">文件后缀名必须为xls或xlsx（即Excel格式），文件大小不得大于2M</div>\r\n              <el-upload\r\n                multiple\r\n                accept=\".xls, .xlsx\"\r\n                :headers=\"headerObj\"\r\n                action=\"/api/cnfic-contract-manage/linkman/importLinkmanFile\"\r\n                :on-success=\"handleChange\"\r\n                :before-upload=\"checkFileSize\"\r\n                :file-list=\"fileList\">\r\n                <el-link type=\"primary\" :underline=\"false\">上传文件</el-link>\r\n              </el-upload>\r\n            </div>\r\n          </div>\r\n          <div class=\"el-import-step-footer\">\r\n            <el-button size=\"small\" type=\"primary\" @click=\"next(2)\">&nbsp;&nbsp;&nbsp;下一步&nbsp;&nbsp;&nbsp;</el-button>\r\n            <el-button size=\"small\" @click=\"closeDialog\">&nbsp;&nbsp;&nbsp;取&nbsp;&nbsp;&nbsp;消&nbsp;&nbsp;&nbsp;\r\n            </el-button>\r\n          </div>\r\n        </div>\r\n        <div class=\"el-import-step\" v-if=\"activeStep==2\">\r\n          <avue-crud\r\n            :option=\"optionSuccess\"\r\n            :table-loading=\"loading\"\r\n            :page.sync=\"passPage\"\r\n            :data=\"dataSuccess\"\r\n            @on-load=\"onLoadSuccess\">\r\n            <template slot=\"header\">\r\n              <div class=\"el-import-list-header\">\r\n                校验成功数据列表\r\n                <el-link type=\"primary\" :underline=\"false\" size=\"small\">{{passPage.total}}条</el-link>\r\n              </div>\r\n            </template>\r\n          </avue-crud>\r\n          <div class=\"el-import-list-pagination\">\r\n            <el-pagination\r\n              background\r\n              @size-change=\"handlePassSizeChange\"\r\n              @current-change=\"handlePassCurrentChange\"\r\n              :current-page=\"passPage.currentPage\"\r\n              :page-size=\"passPage.pageSize\"\r\n              layout=\"total, sizes, prev, pager, next, jumper\"\r\n              :total=\"passPage.total\">\r\n            </el-pagination>\r\n          </div>\r\n          <avue-crud\r\n          :option=\"optionFail\"\r\n          :table-loading=\"loading\"\r\n          :page.sync=\"failPage\"\r\n          :data=\"dataFail\"\r\n          @on-load=\"onLoadFail\">\r\n          <template slot=\"header\">\r\n          <div class=\"el-import-list-header\">\r\n          校验失败数据列表\r\n          <el-link type=\"primary\" :underline=\"false\" size=\"small\">{{failPage.total}}条</el-link>\r\n          <el-link type=\"primary\" :underline=\"false\" size=\"small\" @click=\"exportCheckfaildata\">下载失败数据列表</el-link>\r\n          </div>\r\n          </template>\r\n          </avue-crud>\r\n          <div class=\"el-import-list-pagination\">\r\n          <el-pagination\r\n          background\r\n          @size-change=\"handleFailSizeChange\"\r\n          @current-change=\"handleFailCurrentChange\"\r\n          :current-page=\"failPage.currentPage\"\r\n          :page-size=\"failPage.pageSize\"\r\n          layout=\"total, sizes, prev, pager, next, jumper\"\r\n          :total=\"failPage.total\">\r\n          </el-pagination>\r\n          </div>\r\n          <div class=\"el-import-step-footer\">\r\n            <el-button size=\"small\" type=\"primary\" @click=\"next(1)\">返回重新上传</el-button>\r\n            <el-button size=\"small\" type=\"primary\" @click=\"next(3)\">忽略异常数据导入</el-button>\r\n            <el-button size=\"small\" @click=\"closeDialog\">&nbsp;&nbsp;&nbsp;取&nbsp;&nbsp;&nbsp;消&nbsp;&nbsp;&nbsp;\r\n            </el-button>\r\n          </div>\r\n        </div>\r\n        <div class=\"el-import-step\" v-if=\"activeStep==3\">\r\n          <div class=\"el-import-step-three\">\r\n            <div class=\"el-import-step-download-icon\"><i class=\"el-icon-success\"></i></div>\r\n            <h3>数据导入成功</h3>\r\n            <div class=\"download-tip\">导入数据{{submitPassNum}}条</div>\r\n          </div>\r\n          <div class=\"el-import-step-footer\">\r\n            <el-button size=\"small\" type=\"primary\" @click=\"closeDialog\">&nbsp;&nbsp;&nbsp;完&nbsp;&nbsp;&nbsp;成&nbsp;&nbsp;&nbsp;</el-button>\r\n          </div>\r\n        </div>\r\n      </template>\r\n    </basic-container>\r\n  </el-dialog>\r\n</template>\r\n<script>\r\n  import {checkpassdata, submitpassdata} from \"@/api/contract/customer/contract\";\r\n  import website from \"@/config/website\";\r\n  import {getToken} from '@/util/auth';\r\n\r\n  export default {\r\n    name: \"constractDialog\",\r\n    props: {\r\n      constractDialogFlag: {\r\n        type: Boolean,\r\n        default: false\r\n      }\r\n    },\r\n    data() {\r\n      return {\r\n        loading: false,\r\n        activeStep: 1,\r\n        fileList: [],\r\n        headerObj: {\r\n          \"Authorization\": `Basic ${Base64.encode(`${website.clientId}:${website.clientSecret}`)}`,\r\n          \"TongTech-Auth\": 'Bearer ' + getToken(),\r\n          \"Blade-Auth\": 'Bearer ' + getToken()\r\n        },//附件上传请求头参数\r\n        passPage: {\r\n          pageSize: 10,\r\n          currentPage: 1,\r\n          total: 0\r\n        },\r\n        failPage: {\r\n          pageSize: 10,\r\n          currentPage: 1,\r\n          total: 0\r\n        },\r\n        dataSuccess: [{\r\n          custName: '张三',\r\n          custTypeName: '利率债_金融债_IBABS',\r\n          custStateName: 'XHCJ001',\r\n          businessChanceName: '中央国债登记结算有限责任公司',\r\n          businessDesc: '行情数据'\r\n        }],\r\n        dataFail: [{\r\n          custName: '张三',\r\n          custTypeName: '利率债_金融债_IBABS',\r\n          custStateName: 'XHCJ001',\r\n          businessChanceName: '中央国债登记结算有限责任公司',\r\n          businessDesc: '行情数据',\r\n          msg:\"\",\r\n        }],\r\n        optionSuccess: {\r\n          calcHeight: 100,\r\n          searchShow: true,\r\n          searchMenuSpan: 6,\r\n          border: true,\r\n          index: false,\r\n          viewBtn: false,\r\n          addBtn: false,\r\n          refreshBtn: false,\r\n          columnBtn: false,\r\n          menu: false,\r\n          column: [{\r\n            label: '客户名称',\r\n            prop: 'custName'\r\n          },\r\n          {\r\n            label: '联系人类型',\r\n            prop: 'contactType'\r\n          },\r\n          {\r\n            label: '联系方式',\r\n            prop: 'contactPhone'\r\n          }, {\r\n            label: '客户经理',\r\n            prop: 'custManager'\r\n          },\r\n          {\r\n            label: '所属机构',\r\n            prop: 'custOrgName'\r\n          }]\r\n        },\r\n        optionFail: {\r\n          calcHeight: 210,\r\n          searchShow: true,\r\n          searchMenuSpan: 6,\r\n          border: true,\r\n          index: false,\r\n          viewBtn: false,\r\n          addBtn: false,\r\n          refreshBtn: false,\r\n          columnBtn: false,\r\n          menu: false,\r\n          column: [{\r\n            label: '客户名称',\r\n            prop: 'custName'\r\n          },\r\n            {\r\n              label: '联系人类型',\r\n              prop: 'contactType'\r\n            },\r\n            {\r\n              label: '联系方式',\r\n              prop: 'contactPhone'\r\n            }, {\r\n              label: '客户经理',\r\n              prop: 'custManager'\r\n            },\r\n            {\r\n              label: '所属机构',\r\n              prop: 'custOrgName'\r\n            },{\r\n              label: '错误提示',\r\n              prop: 'msg'\r\n            }\r\n          ]\r\n        },\r\n        redisKey: \"\",\r\n        submitPassNum: 0,\r\n        fileMaxSize: 2 * 1024 * 1024,\r\n      }\r\n    },\r\n    mounted() {\r\n    },\r\n    methods: {\r\n      checkFileSize(file) {\r\n        if (file && file.size > this.fileMaxSize) {\r\n          this.$message.error('文件后缀名必须为xls或xlsx（即Excel格式），文件大小不得大于2M');\r\n          this.fileList = [];\r\n          return false;\r\n        }\r\n        return true;\r\n      },\r\n      exportCheckfaildata() {\r\n        // window.open(`/api/cnfic-contract-manage/blackwhitelist/export-checkfaildata?${website.tokenHeader}=${getToken()}&failRedisKey=${this.failRedisKey}`);\r\n        // window.open(`/api/cnfic-contract-manage/orgcustomer/downloadCustomerTemplate?${website.tokenHeader}=${getToken()}&key=${this.redisKey}`);\r\n        window.open(`/api/cnfic-contract-manage/linkman/downloadContractTemplate?${website.tokenHeader}=${getToken()}&key=${this.redisKey}`);\r\n\r\n\r\n      },\r\n      exportTemplate() {\r\n        window.open(`/api/cnfic-contract-manage/linkman/downloadContractTemplate?${website.tokenHeader}=${getToken()}`);\r\n\r\n      },\r\n      closeDialog() {\r\n        this.next(1);\r\n        this.$emit(\"cancelConstractDialog\");\r\n      },\r\n      handleChange(response, file, fileList) {\r\n        if (response) {\r\n          this.redisKey = response.data;\r\n        }\r\n      },\r\n      onLoadSuccess() {\r\n        this.loading = true;\r\n        const filter = {\r\n          \"redisKey\": this.redisKey,\r\n          \"isSuccess\": true,\r\n        };\r\n        checkpassdata(this.passPage.currentPage, this.passPage.pageSize, filter).then(res => {\r\n          const data = res.data.data;\r\n          this.passPage.total = data.total;\r\n          this.dataSuccess = data.records;\r\n          console.log(this.dataSuccess)\r\n          this.loading = false;\r\n        });\r\n      },\r\n      handlePassSizeChange(size) {\r\n        this.passPage.pageSize = size;\r\n        this.onLoadSuccess();\r\n      },\r\n      handlePassCurrentChange(page) {\r\n        this.passPage.currentPage = page;\r\n        this.onLoadSuccess();\r\n      },\r\n      onLoadFail() {\r\n        this.loading = true;\r\n        const filter = {\r\n          \"redisKey\": this.redisKey,\r\n          \"isSuccess\": false,\r\n        };\r\n        checkpassdata(this.failPage.currentPage, this.failPage.pageSize, filter).then(res => {\r\n          const data = res.data.data;\r\n          this.failPage.total = data.total;\r\n          this.dataFail = data.records;\r\n          this.loading = false;\r\n        });\r\n      },\r\n      handleFailSizeChange(size) {\r\n        this.failPage.pageSize = size;\r\n        this.onLoadFail();\r\n      },\r\n      handleFailCurrentChange(page) {\r\n        this.failPage.currentPage = page;\r\n        this.onLoadFail();\r\n      },\r\n      submitpassdata() {\r\n        this.loading = true;\r\n        const filter = {\"redisKey\": this.redisKey};\r\n        submitpassdata(filter).then(res => {\r\n          this.submitPassNum = res.data.data;\r\n        }, error => {\r\n          window.console.log(error);\r\n        });\r\n      },\r\n      next(step) {\r\n        this.activeStep = step;\r\n        if (step == 3 && this.passPage.total != 0) {\r\n          this.submitpassdata();\r\n        }\r\n      }\r\n    }\r\n  }\r\n</script>\r\n<style lang=\"scss\">\r\n  .el-import-step {\r\n    margin-top: 1rem;\r\n    width: 100%;\r\n    &-download:first-child {\r\n      border-bottom: 1px solid #d9d9db;\r\n    }\r\n    &-download {\r\n      width: 100%;\r\n      display: flex;\r\n      justify-content: center;\r\n      align-items: center;\r\n      padding: 1rem 0;\r\n      &-icon {\r\n        i {\r\n          color: #078ecf;\r\n          font-size: 40px;\r\n          padding: 0 30px;\r\n        }\r\n      }\r\n      &-desc {\r\n        width: 70%;\r\n        div {\r\n          padding: 5px 0;\r\n        }\r\n        div:first-child {\r\n          font-size: 14px;\r\n        }\r\n        .el-link.el-link--primary {\r\n          color: #078ecf;\r\n        }\r\n        .download-tip {\r\n          font-size: 12px;\r\n          color: #9da7b0;\r\n        }\r\n      }\r\n    }\r\n    &-footer {\r\n      text-align: center;\r\n      width: 100%;\r\n      margin-top: 1rem;\r\n      .el-button--small {\r\n        margin: 0 1rem;\r\n      }\r\n    }\r\n    &-three {\r\n      text-align: center;\r\n      h3, div {\r\n        width: 100%;\r\n      }\r\n    }\r\n    .avue-crud__menu {\r\n      min-height: 30px;\r\n    }\r\n    .avue-crud__pagination {\r\n      display: none;\r\n    }\r\n    .el-import-list-header {\r\n      height: 40px;\r\n      line-height: 40px;\r\n      font-size: 14px;\r\n      color: #9da7b0;\r\n      .el-link {\r\n        vertical-align: initial;\r\n      }\r\n      a {\r\n        color: #078ecf;\r\n        margin: 0 10px;\r\n      }\r\n    }\r\n    .el-import-list-pagination {\r\n      text-align: center;\r\n      width: 100%;\r\n      margin-top: 1rem;\r\n    }\r\n  }\r\n</style>\r\n"]}]}