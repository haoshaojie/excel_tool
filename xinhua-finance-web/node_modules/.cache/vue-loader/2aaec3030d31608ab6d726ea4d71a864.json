{"remainingRequest":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\src\\views\\contract\\contract\\components\\basicInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\src\\views\\contract\\contract\\components\\basicInfo.vue","mtime":1618568524334},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport {getDictByCode} from \"@/api/system/dict\";\r\nimport customerDialog from \"@/views/contract/customer/customerDialog\";\r\nimport linkPersonDialog from \"@/views/contract/userAccount/linkPersonDialog\";\r\nimport {getContractList} from \"@/api/contract/user/orguser\";\r\nimport {getDept} from \"@/api/system/dept\";\r\nimport {getToken} from '@/util/auth';\r\nimport website from \"@/config/website\";\r\nexport default {\r\n    name:\"basic-info\",\r\n    components: {\r\n      customerDialog,\r\n      linkPersonDialog\r\n    },\r\n    props:{\r\n      dicDataList:[],\r\n      basicInfo:{}\r\n    },\r\n    data(){\r\n        return{\r\n            conLimitList:[],//合约范围\r\n            conTypeList:[],//合约类型\r\n            conStateList:[],//合约状态\r\n            signStateList:[],//签约状态\r\n            signTypeList:[],//签约类型\r\n            renewalStateList:[],//续约状态\r\n            customerDialogFlag:false,\r\n            showLinkPersonDialog:false,\r\n            headerObj: {\r\n                \"Authorization\": `Basic ${Base64.encode(`${website.clientId}:${website.clientSecret}`)}`,\r\n                \"TongTech-Auth\": 'Bearer ' + getToken(),\r\n                \"Blade-Auth\": 'Bearer ' + getToken()\r\n            },//附件上传请求头参数\r\n            basicInfoRules:{\r\n                conName:[{required: true,message: '请输入合约名称',trigger: \"blur\"}],\r\n                conLimit:[{required: true,message: '请选择合约范围',trigger: \"change\"}],\r\n                conType:[{required: true,message: '请选择合约类型',trigger: \"change\"}],\r\n                conState:[{required: true,message: '请选择合约状态',trigger: \"change\"}],\r\n                deptId:[{required: true,message: '请选择所属部门',trigger: \"change\"}],\r\n                custName:[{required: true,message: '请选择客户',trigger: \"change\"}],\r\n                signState:[{required: true,message: '请选择签约状态',trigger: \"change\"}],\r\n                signType:[{required: true,message: '请选择签约类型',trigger: \"change\"}],\r\n                renewalState:[{required: true,message: '请选择续约状态',trigger: \"change\"}],\r\n                signDate:[{required: true,message: '请选择签约日期',trigger: \"blur\"}],\r\n                contractTime:[{required: true,message: '请选择合约起止日期',trigger: \"blur\"}],\r\n            },\r\n            option:{\r\n                calcHeight: 210,\r\n                searchShow: true,\r\n                searchMenuSpan: 6,\r\n                tip: false,\r\n                border: true,\r\n                index: false,\r\n                header:false,\r\n                menu:false,\r\n                selection: false,\r\n                column:[\r\n                    {\r\n                        prop:\"contactPerson\",\r\n                        label:\"联系人\",\r\n                    },\r\n                    {\r\n                        prop:\"contactType\",\r\n                        label:\"联系人类型\",\r\n                    },\r\n                    {\r\n                        prop:\"contactPhone\",\r\n                        label:\"联系方式\",\r\n                    },\r\n                    {\r\n                        prop:\"contactEmail\",\r\n                        label:\"邮箱\",\r\n                    },\r\n                    {\r\n                        prop:\"contactDept\",\r\n                        label:\"部门\",\r\n                    },\r\n                    {\r\n                        prop:\"contactJob\",\r\n                        label:\"职务\",\r\n                    },\r\n                     {\r\n                        prop:\"custManager\",\r\n                        label:\"客户经理\",\r\n                    },\r\n                    {\r\n                        prop:\"custOrgName\",\r\n                        label:\"所属机构\",\r\n                    }\r\n                ]\r\n            }\r\n        }\r\n    },\r\n    mounted(){\r\n      this.onLoad();\r\n    },\r\n    methods:{\r\n      handlePreview(){},\r\n      handleRemove(file){\r\n        let index = this.basicInfo.fileList.findIndex( fileItem => {\r\n            return fileItem.uid === file.uid\r\n        })\r\n        this.basicInfo.fileList.splice(index, 1)\r\n      },\r\n      beforeRemove(){},\r\n      handleSuccess(response, file, fileList){\r\n          this.basicInfo.fileList = fileList;\r\n      },\r\n      //上传之前校验方法\r\n      onBeforeUpload(file){\r\n        var fileName = file.name;\r\n        var filextension=fileName.substring(fileName.lastIndexOf(\".\"),fileName.length);\r\n        filextension=filextension.toLowerCase();\r\n        var typeRight=true;\r\n        if((filextension!='.pdf')&&(filextension!='.doc')&&(filextension!='.docx')&&(filextension!='.zip')&&(filextension!='.rar')){\r\n          typeRight = false;\r\n          this.$message.error('合同附件仅支持上传.doc .docx .pdf .rar .zip格式');\r\n        }\r\n        const isLt1M = file.size / 1024 / 1024 < 2;\r\n        if (!isLt1M) {\r\n            this.$message.error('上传文件大小不能超过 2MB!');\r\n        }\r\n        return typeRight && isLt1M;\r\n      },\r\n      //附件超出个数方法\r\n      handleExceed(){\r\n          this.$message.error('最多支持5个附件');\r\n      },\r\n      saveBasic(){\r\n        this.$refs['basicInfo'].validate((valid)=>{\r\n          if(valid){\r\n            this.$emit(\"saveBasic\");\r\n          }else{\r\n            this.$message.error('请输入必填字段');\r\n          }\r\n        })\r\n      },\r\n      next(){\r\n          this.$emit(\"update\",2);\r\n      },\r\n      //上级单位弹窗\r\n      addSuperUnit() {\r\n        this.customerDialogFlag = true\r\n      },\r\n      //接受选择客户\r\n      acceptSuperUnit(row) {\r\n        this.basicInfo.custName = row.custName;\r\n        this.basicInfo.custId = row.id;\r\n        this.data = [];\r\n        //查询联系人信息，如果只有一个联系人，直接放到联系人列表里\r\n        getContractList(row.id).then(res => {\r\n          this.basicInfo.contactsNumber = res.data.data.length;\r\n          if(res.data.data.length==1){\r\n            this.basicInfo.custContract = res.data.data;\r\n            getDept(this.basicInfo.custContract[0].custOrg).then(r => {\r\n              this.basicInfo.custContract.custOrgName = r.data.data.deptName;\r\n            },error =>{\r\n              this.$message.error('所属机构未找到');\r\n            });\r\n          }\r\n        })\r\n      },\r\n      cancelCustomerDialog() {\r\n        this.customerDialogFlag = false\r\n      },\r\n      //打开联系人选择页面\r\n      openLinkPersonDialog() {\r\n        if(this.basicInfo.custId == \"\"){\r\n          this.$message.error('请先选择客户');\r\n          return;\r\n        }\r\n        this.showLinkPersonDialog = true;\r\n      },\r\n      chooseLinkPerson(row) {\r\n        this.basicInfo.custContract = [];\r\n        this.basicInfo.custContract.push(row);\r\n        this.basicInfo.custContractId = row.id;\r\n      },\r\n      cancelLinkPersonDialog() {\r\n        this.showLinkPersonDialog = false;\r\n      },\r\n      onLoad() {\r\n        getDictByCode(this.CONSTANT.CONTRACT_SCOPE).then(res => {\r\n          this.conLimitList=res.data.data\r\n        });\r\n        getDictByCode(this.CONSTANT.CONTRACT_TYPE).then(res => {\r\n          this.conTypeList=res.data.data\r\n        });\r\n        getDictByCode(this.CONSTANT.CONTRACT_STATE).then(res => {\r\n          this.conStateList=res.data.data\r\n        });\r\n        getDictByCode(this.CONSTANT.SIGN_STATE).then(res => {\r\n          this.signStateList=res.data.data\r\n        });\r\n        getDictByCode(this.CONSTANT.SIGN_TYPE).then(res => {\r\n          this.signTypeList=res.data.data\r\n        });\r\n        getDictByCode(this.CONSTANT.RENEWAL_STATE).then(res => {\r\n          this.renewalStateList=res.data.data\r\n        });\r\n      }\r\n    }\r\n}\r\n",{"version":3,"sources":["basicInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"basicInfo.vue","sourceRoot":"src/views/contract/contract/components","sourcesContent":["<!--基本信息--->\r\n<template>\r\n    <basic-container>\r\n        <div class=\"el-basic-title\">基本信息</div>\r\n        <div  class=\"el-basic-content\">\r\n            <el-form size=\"small\" ref=\"basicInfo\" label-position=\"left\" label-width=\"110px\" :model=\"basicInfo\" :inline=\"true\" :rules=\"basicInfoRules\">\r\n                <el-row>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"合约名称\" prop=\"conName\">\r\n                            <el-input placeholder=\"合约名称\" v-model=\"basicInfo.conName\"></el-input>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"合约范围\" prop=\"conLimit\">\r\n                            <el-radio-group v-model=\"basicInfo.conLimit\">\r\n                                <el-radio v-for=\"(item,i) in conLimitList\" :key=\"i\" :label=\"item.dictKey\">{{item.dictValue}}</el-radio>\r\n                            </el-radio-group>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                </el-row>\r\n                <el-row>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"合约类型\" prop=\"conType\">\r\n                            <el-select placeholder=\"合约类型\" v-model=\"basicInfo.conType\">\r\n                                <el-option v-for=\"(item,i) in conTypeList\" :key=\"i\" :label=\"item.dictValue\" :value=\"item.dictKey\"></el-option>\r\n                            </el-select>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"合约状态\" prop=\"conState\">\r\n                             <el-radio-group v-model=\"basicInfo.conState\">\r\n                                <el-radio v-for=\"(item,i) in conStateList\" :key=\"i\" :label=\"item.dictKey\">{{item.dictValue}}</el-radio>\r\n                            </el-radio-group>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                </el-row>\r\n                <el-row>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"所属部门\" prop=\"deptId\">\r\n                            <el-select placeholder=\"所属部门\" v-model=\"basicInfo.deptId\">\r\n                                <el-option v-for=\"(item,i) in dicDataList\" :key=\"i\" :label=\"item.title\" :value=\"item.value\"></el-option>\r\n                            </el-select>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"客户名称\" prop=\"custName\">\r\n                            <el-input v-model=\"basicInfo.custName\" disabled placeholder=\"请选择客户\" style=\"width: 100%;\">\r\n                                <el-button slot=\"append\" icon=\"el-icon-plus\" size=\"mini\" @click=\"addSuperUnit\"></el-button>\r\n                            </el-input>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                </el-row>\r\n                 <el-row>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"签约乙方\" prop=\"conPartb\">\r\n                            <el-input placeholder=\"签约乙方\" v-model=\"basicInfo.conPartb\"></el-input>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"签约状态\" prop=\"signState\">\r\n                            <el-select placeholder=\"签约状态\" v-model=\"basicInfo.signState\">\r\n                                <el-option v-for=\"(item,i) in signStateList\" :key=\"i\" :label=\"item.dictValue\" :value=\"item.dictKey\"></el-option>\r\n                            </el-select>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                </el-row>\r\n                <el-row>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"签约类型\" prop=\"signType\">\r\n                            <el-select placeholder=\"签约类型\" v-model=\"basicInfo.signType\">\r\n                                <el-option v-for=\"(item,i) in signTypeList\" :key=\"i\" :label=\"item.dictValue\" :value=\"item.dictKey\"></el-option>\r\n                            </el-select>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"续约状态\" prop=\"renewalState\">\r\n                             <el-select placeholder=\"续约状态\" v-model=\"basicInfo.renewalState\">\r\n                                <el-option v-for=\"(item,i) in renewalStateList\" :key=\"i\" :label=\"item.dictValue\" :value=\"item.dictKey\"></el-option>\r\n                            </el-select>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                </el-row>\r\n                <el-row>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"签约日期\" prop=\"signDate\">\r\n                            <el-date-picker \r\n                                placeholder=\"签约日期\"\r\n                                type=\"date\"\r\n                                value-format=\"yyyy-MM-dd\"\r\n                                format=\"yyyy-MM-dd\"\r\n                                v-model=\"basicInfo.signDate\">\r\n                            </el-date-picker>\r\n                            </el-form-item>\r\n                    </el-col>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"合约起止日期\" prop=\"contractTime\">\r\n                             <el-date-picker\r\n                                v-model=\"basicInfo.contractTime\"\r\n                                type=\"daterange\"\r\n                                value-format=\"yyyy-MM-dd\"\r\n                                format=\"yyyy-MM-dd\"\r\n                                range-separator=\"至\"\r\n                                start-placeholder=\"合约起始时间\"\r\n                                end-placeholder=\"合约终止时间\">\r\n                                </el-date-picker>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                </el-row>\r\n                <el-row>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"合约金额\" prop=\"conAmount\">\r\n                             <el-input placeholder=\"合约金额\" type=\"number\" v-model.number=\"basicInfo.conAmount\">\r\n                                <template slot=\"append\">元</template>\r\n                            </el-input>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                    <el-col :span=\"12\">\r\n                        <el-form-item label=\"合约当年期金额\" prop=\"conCurrAmount\">\r\n                            <el-input placeholder=\"合约当年期金额\" type=\"number\" v-model.number=\"basicInfo.conCurrAmount\">\r\n                                <template slot=\"append\">元</template>\r\n                            </el-input>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                </el-row>\r\n                <el-row>\r\n                    <el-col>\r\n                        <el-form-item label=\"具体服务要求\" prop=\"conDemand\">\r\n                            <el-input \r\n                            placeholder=\"具体服务要求\" \r\n                            type=\"textarea\" \r\n                            v-model=\"basicInfo.conDemand\"\r\n                            :autosize=\"{minRows:4,maxRows:6}\"\r\n                            ></el-input>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                </el-row>\r\n                <el-row>\r\n                    <el-col>\r\n                        <el-form-item label=\"合约附件\">\r\n                           <el-upload\r\n                                action=\"/api/cnfic-resource/oss/file/putFile\"\r\n                                :headers=\"headerObj\"\r\n                                :on-preview=\"handlePreview\"\r\n                                :on-remove=\"handleRemove\"\r\n                                :before-remove=\"beforeRemove\"\r\n                                :before-upload=\"onBeforeUpload\"\r\n                                :on-success=\"handleSuccess\"\r\n                                multiple\r\n                                :on-exceed=\"handleExceed\"\r\n                                accept=\".pdf, .doc, .docx, .rar, .zip\"\r\n                                :limit=\"5\"\r\n                                :file-list=\"basicInfo.fileList\">\r\n                                <el-button size=\"small\" type=\"primary\">添加附件</el-button>\r\n                                合同附件支持上传.docx .doc .pdf .rar .zip格式，最多支持5个附件，单个附件不大于2M\r\n                                </el-upload>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                </el-row>\r\n                <el-row>\r\n                    <el-col :span=\"24\">\r\n                        <el-form-item label=\"合约联系人\">\r\n                           <el-button icon=\"el-icon-plus\" class=\"add-contacts\" @click=\"openLinkPersonDialog\">选择联系人({{basicInfo.contactsNumber}})</el-button>\r\n                           <avue-crud\r\n                            :option=\"option\"\r\n                            :data=\"basicInfo.custContract\"\r\n                           ></avue-crud>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                </el-row>\r\n                 <el-row>\r\n                    <el-col :span=\"24\">\r\n                        <el-form-item class=\"el-step-footer\">\r\n                            <el-button type=\"primary\" @click=\"saveBasic\">保&nbsp;&nbsp;&nbsp;存</el-button>\r\n                             <el-button type=\"primary\" plain @click=\"next\">下一步</el-button>\r\n                        </el-form-item>\r\n                    </el-col>\r\n                 </el-row>\r\n            </el-form>\r\n        </div>\r\n        <customer-dialog ref=\"customerDialog\" :customerDialogFlag=\"customerDialogFlag\" @acceptSuperUnit=\"acceptSuperUnit\"\r\n                     @cancelCustomerDialog=\"cancelCustomerDialog\"></customer-dialog>\r\n        <link-person-dialog ref=\"linkPersonDialog\"\r\n                        :showLinkPersonDialog=\"showLinkPersonDialog\"\r\n                        :customerId=\"basicInfo.custId\"\r\n                        @chooseLinkPerson=\"chooseLinkPerson\"\r\n                        @cancelLinkPersonDialog=\"cancelLinkPersonDialog\"/>\r\n    </basic-container>\r\n</template>\r\n<script>\r\nimport {getDictByCode} from \"@/api/system/dict\";\r\nimport customerDialog from \"@/views/contract/customer/customerDialog\";\r\nimport linkPersonDialog from \"@/views/contract/userAccount/linkPersonDialog\";\r\nimport {getContractList} from \"@/api/contract/user/orguser\";\r\nimport {getDept} from \"@/api/system/dept\";\r\nimport {getToken} from '@/util/auth';\r\nimport website from \"@/config/website\";\r\nexport default {\r\n    name:\"basic-info\",\r\n    components: {\r\n      customerDialog,\r\n      linkPersonDialog\r\n    },\r\n    props:{\r\n      dicDataList:[],\r\n      basicInfo:{}\r\n    },\r\n    data(){\r\n        return{\r\n            conLimitList:[],//合约范围\r\n            conTypeList:[],//合约类型\r\n            conStateList:[],//合约状态\r\n            signStateList:[],//签约状态\r\n            signTypeList:[],//签约类型\r\n            renewalStateList:[],//续约状态\r\n            customerDialogFlag:false,\r\n            showLinkPersonDialog:false,\r\n            headerObj: {\r\n                \"Authorization\": `Basic ${Base64.encode(`${website.clientId}:${website.clientSecret}`)}`,\r\n                \"TongTech-Auth\": 'Bearer ' + getToken(),\r\n                \"Blade-Auth\": 'Bearer ' + getToken()\r\n            },//附件上传请求头参数\r\n            basicInfoRules:{\r\n                conName:[{required: true,message: '请输入合约名称',trigger: \"blur\"}],\r\n                conLimit:[{required: true,message: '请选择合约范围',trigger: \"change\"}],\r\n                conType:[{required: true,message: '请选择合约类型',trigger: \"change\"}],\r\n                conState:[{required: true,message: '请选择合约状态',trigger: \"change\"}],\r\n                deptId:[{required: true,message: '请选择所属部门',trigger: \"change\"}],\r\n                custName:[{required: true,message: '请选择客户',trigger: \"change\"}],\r\n                signState:[{required: true,message: '请选择签约状态',trigger: \"change\"}],\r\n                signType:[{required: true,message: '请选择签约类型',trigger: \"change\"}],\r\n                renewalState:[{required: true,message: '请选择续约状态',trigger: \"change\"}],\r\n                signDate:[{required: true,message: '请选择签约日期',trigger: \"blur\"}],\r\n                contractTime:[{required: true,message: '请选择合约起止日期',trigger: \"blur\"}],\r\n            },\r\n            option:{\r\n                calcHeight: 210,\r\n                searchShow: true,\r\n                searchMenuSpan: 6,\r\n                tip: false,\r\n                border: true,\r\n                index: false,\r\n                header:false,\r\n                menu:false,\r\n                selection: false,\r\n                column:[\r\n                    {\r\n                        prop:\"contactPerson\",\r\n                        label:\"联系人\",\r\n                    },\r\n                    {\r\n                        prop:\"contactType\",\r\n                        label:\"联系人类型\",\r\n                    },\r\n                    {\r\n                        prop:\"contactPhone\",\r\n                        label:\"联系方式\",\r\n                    },\r\n                    {\r\n                        prop:\"contactEmail\",\r\n                        label:\"邮箱\",\r\n                    },\r\n                    {\r\n                        prop:\"contactDept\",\r\n                        label:\"部门\",\r\n                    },\r\n                    {\r\n                        prop:\"contactJob\",\r\n                        label:\"职务\",\r\n                    },\r\n                     {\r\n                        prop:\"custManager\",\r\n                        label:\"客户经理\",\r\n                    },\r\n                    {\r\n                        prop:\"custOrgName\",\r\n                        label:\"所属机构\",\r\n                    }\r\n                ]\r\n            }\r\n        }\r\n    },\r\n    mounted(){\r\n      this.onLoad();\r\n    },\r\n    methods:{\r\n      handlePreview(){},\r\n      handleRemove(file){\r\n        let index = this.basicInfo.fileList.findIndex( fileItem => {\r\n            return fileItem.uid === file.uid\r\n        })\r\n        this.basicInfo.fileList.splice(index, 1)\r\n      },\r\n      beforeRemove(){},\r\n      handleSuccess(response, file, fileList){\r\n          this.basicInfo.fileList = fileList;\r\n      },\r\n      //上传之前校验方法\r\n      onBeforeUpload(file){\r\n        var fileName = file.name;\r\n        var filextension=fileName.substring(fileName.lastIndexOf(\".\"),fileName.length);\r\n        filextension=filextension.toLowerCase();\r\n        var typeRight=true;\r\n        if((filextension!='.pdf')&&(filextension!='.doc')&&(filextension!='.docx')&&(filextension!='.zip')&&(filextension!='.rar')){\r\n          typeRight = false;\r\n          this.$message.error('合同附件仅支持上传.doc .docx .pdf .rar .zip格式');\r\n        }\r\n        const isLt1M = file.size / 1024 / 1024 < 2;\r\n        if (!isLt1M) {\r\n            this.$message.error('上传文件大小不能超过 2MB!');\r\n        }\r\n        return typeRight && isLt1M;\r\n      },\r\n      //附件超出个数方法\r\n      handleExceed(){\r\n          this.$message.error('最多支持5个附件');\r\n      },\r\n      saveBasic(){\r\n        this.$refs['basicInfo'].validate((valid)=>{\r\n          if(valid){\r\n            this.$emit(\"saveBasic\");\r\n          }else{\r\n            this.$message.error('请输入必填字段');\r\n          }\r\n        })\r\n      },\r\n      next(){\r\n          this.$emit(\"update\",2);\r\n      },\r\n      //上级单位弹窗\r\n      addSuperUnit() {\r\n        this.customerDialogFlag = true\r\n      },\r\n      //接受选择客户\r\n      acceptSuperUnit(row) {\r\n        this.basicInfo.custName = row.custName;\r\n        this.basicInfo.custId = row.id;\r\n        this.data = [];\r\n        //查询联系人信息，如果只有一个联系人，直接放到联系人列表里\r\n        getContractList(row.id).then(res => {\r\n          this.basicInfo.contactsNumber = res.data.data.length;\r\n          if(res.data.data.length==1){\r\n            this.basicInfo.custContract = res.data.data;\r\n            getDept(this.basicInfo.custContract[0].custOrg).then(r => {\r\n              this.basicInfo.custContract.custOrgName = r.data.data.deptName;\r\n            },error =>{\r\n              this.$message.error('所属机构未找到');\r\n            });\r\n          }\r\n        })\r\n      },\r\n      cancelCustomerDialog() {\r\n        this.customerDialogFlag = false\r\n      },\r\n      //打开联系人选择页面\r\n      openLinkPersonDialog() {\r\n        if(this.basicInfo.custId == \"\"){\r\n          this.$message.error('请先选择客户');\r\n          return;\r\n        }\r\n        this.showLinkPersonDialog = true;\r\n      },\r\n      chooseLinkPerson(row) {\r\n        this.basicInfo.custContract = [];\r\n        this.basicInfo.custContract.push(row);\r\n        this.basicInfo.custContractId = row.id;\r\n      },\r\n      cancelLinkPersonDialog() {\r\n        this.showLinkPersonDialog = false;\r\n      },\r\n      onLoad() {\r\n        getDictByCode(this.CONSTANT.CONTRACT_SCOPE).then(res => {\r\n          this.conLimitList=res.data.data\r\n        });\r\n        getDictByCode(this.CONSTANT.CONTRACT_TYPE).then(res => {\r\n          this.conTypeList=res.data.data\r\n        });\r\n        getDictByCode(this.CONSTANT.CONTRACT_STATE).then(res => {\r\n          this.conStateList=res.data.data\r\n        });\r\n        getDictByCode(this.CONSTANT.SIGN_STATE).then(res => {\r\n          this.signStateList=res.data.data\r\n        });\r\n        getDictByCode(this.CONSTANT.SIGN_TYPE).then(res => {\r\n          this.signTypeList=res.data.data\r\n        });\r\n        getDictByCode(this.CONSTANT.RENEWAL_STATE).then(res => {\r\n          this.renewalStateList=res.data.data\r\n        });\r\n      }\r\n    }\r\n}\r\n</script>\r\n"]}]}