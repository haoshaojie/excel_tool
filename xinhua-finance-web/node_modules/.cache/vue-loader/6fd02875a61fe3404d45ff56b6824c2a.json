{"remainingRequest":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\src\\views\\contract\\contract\\addContract.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\src\\views\\contract\\contract\\addContract.vue","mtime":1618568524332},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport basicInfo from './components/basicInfo';\r\nimport productInfo from './components/productInfo';\r\nimport userAgreementInfo from './components/userAgreementInfo';\r\nimport authorizationInfo from './components/authorizationInfo';\r\nimport {saveBasicInfo, saveUserAgreementInfo} from \"@/api/contract/contract/contract\";\r\nimport {Message} from 'element-ui'\r\nexport default {\r\n    name:\"add-contract\",\r\n    components:{\r\n        basicInfo,\r\n        productInfo,\r\n        userAgreementInfo,\r\n        authorizationInfo\r\n    },\r\n    props:{\r\n      id:'',\r\n      title:\"新增\",\r\n      dicDataList:[]\r\n    },\r\n    data(){\r\n        return{\r\n            activeStep:1,\r\n            contractInfo:{\r\n                id:\"\",\r\n                basicInfo:{\r\n                    conSource:\"\",\r\n                    conNcId:\"\",\r\n                    conNcNo:\"\",\r\n                    conNo:\"\",\r\n                    conName:\"\",\r\n                    conLimit:\"\",\r\n                    custId:\"\",\r\n                    custName:\"\",\r\n                    custContractId:\"\",\r\n                    deptId:\"\",\r\n                    conPartb:\"\",\r\n                    conType:\"\",\r\n                    conState:\"\",\r\n                    signState:\"\",\r\n                    signType:\"\",\r\n                    renewalState:\"\",\r\n                    signDate:\"\",\r\n                    contractTime:\"\",\r\n                    conStartTime:\"\",\r\n                    conEndTime:\"\",\r\n                    conAmount:\"\",\r\n                    conCurrAmount:\"\",\r\n                    conDemand:\"\",\r\n                    isCreated:\"\",\r\n\r\n                    fileList:[],//用户协议附件list\r\n                    custContract:[],//合约联系人信息\r\n                    contactsNumber:0//可选合约联系人数量\r\n                },\r\n                productInfo:{},\r\n                userAgreementInfo:{},\r\n                authorizationInfo:{}\r\n            }\r\n        }\r\n    },\r\n    methods:{\r\n        updateStep(step){\r\n            if(step==5){\r\n                this.activeStep=1;\r\n                this.$emit(\"addBack\");\r\n            }else{\r\n                this.activeStep=step;\r\n            }\r\n        },\r\n        goBackList() {\r\n          this.$emit(\"addBack\");\r\n        },\r\n        //保存基本信息\r\n        saveBasic(){\r\n            this.contractInfo.basicInfo.id = this.contractInfo.id;//有可能其他模块先创建数据，已经生成了合约id，但是basicinfo里面id还没有，所以这里要赋值一下\r\n            var basicInfo = this.contractInfo.basicInfo;\r\n            if(basicInfo.contractTime){\r\n                basicInfo.conStartTime = basicInfo.contractTime[0] + \" 00:00:00\";\r\n                basicInfo.conEndTime = basicInfo.contractTime[1] + \" 23:59:59\";\r\n            }\r\n            var fileList = basicInfo.fileList;\r\n            for(let i =0; i<fileList.length; i++){\r\n                fileList[i].fileUrl = fileList[i].response.data.link;\r\n                fileList[i].fileName = fileList[i].name;\r\n                fileList[i].status = null;\r\n            }\r\n            saveBasicInfo(basicInfo).then(res =>{\r\n                this.contractInfo.id = res.data.data.id;\r\n                this.contractInfo.basicInfo.id = res.data.data.id;\r\n                this.contractInfo.basicInfo.conNo = res.data.data.conNo;\r\n                this.contractInfo.basicInfo.isCreated = res.data.data.isCreated;\r\n                this.$message.success('保存成功');\r\n            } ,error =>{\r\n                this.$message.error(error);\r\n            });\r\n        },\r\n        saveUserAgreementInfo(userAgreementInfo) {\r\n           let vm = this;\r\n            // 如果未选择数据 则不做处理\r\n            if (userAgreementInfo == null || userAgreementInfo == undefined ) return;\r\n            this.contractInfo.userAgreementInfo = userAgreementInfo;\r\n            console.log(this.contractInfo.userAgreementInfo);\r\n            console.log(userAgreementInfo);\r\n            // 抽取协议id\r\n            let agreementId = [];\r\n            userAgreementInfo.forEach(function(value,index){\r\n              agreementId.push(\"\".concat(value.id));\r\n            })\r\n            // 定义传值对象\r\n            let params = {\r\n              id: this.contractInfo.id,\r\n              agreementIdList: agreementId\r\n            }\r\n\r\n            // 保存信息\r\n            saveUserAgreementInfo(params).then(function (rtnData) {\r\n              vm.contractInfo.id = rtnData.data.data;\r\n              Message({\r\n                message: rtnData.data.msg,\r\n                type: 'success'\r\n              })\r\n            });\r\n        }\r\n    }\r\n}\r\n",{"version":3,"sources":["addContract.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAsBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"addContract.vue","sourceRoot":"src/views/contract/contract","sourcesContent":["<!--创建合约-->\r\n<template>\r\n   <basic-container>\r\n        <el-row style=\"margin-bottom: 20px;\">\r\n        <el-col :span=\"24\">\r\n          <el-page-header @back=\"goBackList\" :content=\"title\">\r\n          </el-page-header>\r\n        </el-col>\r\n        </el-row>\r\n       <el-steps :active=\"activeStep\">\r\n            <el-step title=\"基本信息\"></el-step>\r\n            <el-step title=\"产品信息\"></el-step>\r\n            <el-step title=\"用户协议\"></el-step>\r\n            <el-step title=\"用户授权\"></el-step>\r\n        </el-steps>\r\n        <basic-info ref=\"basicInfo\" v-if=\"activeStep==1\" @update=\"updateStep\" :dicDataList=\"dicDataList\" :basicInfo=\"contractInfo.basicInfo\" @saveBasic=\"saveBasic\"></basic-info>\r\n        <product-info ref=\"productInfo\" v-if=\"activeStep==2\" @update=\"updateStep\"></product-info>\r\n        <user-agreement-info  ref=\"userAgreementInfo\" v-if=\"activeStep==3\" @update=\"updateStep\"  @saveUserAgreementInfo=\"saveUserAgreementInfo\" :userAgreementInfo=\"contractInfo.userAgreementInfo\"></user-agreement-info>\r\n        <authorization-info  ref=\"authorizationInfo\" v-if=\"activeStep==4\" @update=\"updateStep\"></authorization-info>\r\n   </basic-container>\r\n</template>\r\n<script>\r\nimport basicInfo from './components/basicInfo';\r\nimport productInfo from './components/productInfo';\r\nimport userAgreementInfo from './components/userAgreementInfo';\r\nimport authorizationInfo from './components/authorizationInfo';\r\nimport {saveBasicInfo, saveUserAgreementInfo} from \"@/api/contract/contract/contract\";\r\nimport {Message} from 'element-ui'\r\nexport default {\r\n    name:\"add-contract\",\r\n    components:{\r\n        basicInfo,\r\n        productInfo,\r\n        userAgreementInfo,\r\n        authorizationInfo\r\n    },\r\n    props:{\r\n      id:'',\r\n      title:\"新增\",\r\n      dicDataList:[]\r\n    },\r\n    data(){\r\n        return{\r\n            activeStep:1,\r\n            contractInfo:{\r\n                id:\"\",\r\n                basicInfo:{\r\n                    conSource:\"\",\r\n                    conNcId:\"\",\r\n                    conNcNo:\"\",\r\n                    conNo:\"\",\r\n                    conName:\"\",\r\n                    conLimit:\"\",\r\n                    custId:\"\",\r\n                    custName:\"\",\r\n                    custContractId:\"\",\r\n                    deptId:\"\",\r\n                    conPartb:\"\",\r\n                    conType:\"\",\r\n                    conState:\"\",\r\n                    signState:\"\",\r\n                    signType:\"\",\r\n                    renewalState:\"\",\r\n                    signDate:\"\",\r\n                    contractTime:\"\",\r\n                    conStartTime:\"\",\r\n                    conEndTime:\"\",\r\n                    conAmount:\"\",\r\n                    conCurrAmount:\"\",\r\n                    conDemand:\"\",\r\n                    isCreated:\"\",\r\n\r\n                    fileList:[],//用户协议附件list\r\n                    custContract:[],//合约联系人信息\r\n                    contactsNumber:0//可选合约联系人数量\r\n                },\r\n                productInfo:{},\r\n                userAgreementInfo:{},\r\n                authorizationInfo:{}\r\n            }\r\n        }\r\n    },\r\n    methods:{\r\n        updateStep(step){\r\n            if(step==5){\r\n                this.activeStep=1;\r\n                this.$emit(\"addBack\");\r\n            }else{\r\n                this.activeStep=step;\r\n            }\r\n        },\r\n        goBackList() {\r\n          this.$emit(\"addBack\");\r\n        },\r\n        //保存基本信息\r\n        saveBasic(){\r\n            this.contractInfo.basicInfo.id = this.contractInfo.id;//有可能其他模块先创建数据，已经生成了合约id，但是basicinfo里面id还没有，所以这里要赋值一下\r\n            var basicInfo = this.contractInfo.basicInfo;\r\n            if(basicInfo.contractTime){\r\n                basicInfo.conStartTime = basicInfo.contractTime[0] + \" 00:00:00\";\r\n                basicInfo.conEndTime = basicInfo.contractTime[1] + \" 23:59:59\";\r\n            }\r\n            var fileList = basicInfo.fileList;\r\n            for(let i =0; i<fileList.length; i++){\r\n                fileList[i].fileUrl = fileList[i].response.data.link;\r\n                fileList[i].fileName = fileList[i].name;\r\n                fileList[i].status = null;\r\n            }\r\n            saveBasicInfo(basicInfo).then(res =>{\r\n                this.contractInfo.id = res.data.data.id;\r\n                this.contractInfo.basicInfo.id = res.data.data.id;\r\n                this.contractInfo.basicInfo.conNo = res.data.data.conNo;\r\n                this.contractInfo.basicInfo.isCreated = res.data.data.isCreated;\r\n                this.$message.success('保存成功');\r\n            } ,error =>{\r\n                this.$message.error(error);\r\n            });\r\n        },\r\n        saveUserAgreementInfo(userAgreementInfo) {\r\n           let vm = this;\r\n            // 如果未选择数据 则不做处理\r\n            if (userAgreementInfo == null || userAgreementInfo == undefined ) return;\r\n            this.contractInfo.userAgreementInfo = userAgreementInfo;\r\n            console.log(this.contractInfo.userAgreementInfo);\r\n            console.log(userAgreementInfo);\r\n            // 抽取协议id\r\n            let agreementId = [];\r\n            userAgreementInfo.forEach(function(value,index){\r\n              agreementId.push(\"\".concat(value.id));\r\n            })\r\n            // 定义传值对象\r\n            let params = {\r\n              id: this.contractInfo.id,\r\n              agreementIdList: agreementId\r\n            }\r\n\r\n            // 保存信息\r\n            saveUserAgreementInfo(params).then(function (rtnData) {\r\n              vm.contractInfo.id = rtnData.data.data;\r\n              Message({\r\n                message: rtnData.data.msg,\r\n                type: 'success'\r\n              })\r\n            });\r\n        }\r\n    }\r\n}\r\n</script>\r\n<style lang=\"scss\">\r\n.el-basic-title{\r\n    font-size: 16px;\r\n    font-weight: 500;\r\n    color: #333;\r\n    padding:1rem 0;\r\n}\r\n.el-product-btn{\r\n   margin: 0 0 1rem 0.5rem;\r\n}\r\n.el-basic-content{\r\n    .el-form--inline .el-form-item,\r\n    .el-select,\r\n    .el-date-editor.el-input,\r\n    .el-range-editor--small.el-input__inner{\r\n        width: 100%;\r\n    }\r\n    .el-form--inline .el-form-item__content{\r\n        width: calc( 100% - 200px );\r\n    }\r\n    .add-contacts{\r\n        margin-bottom: 1rem;\r\n    }\r\n}\r\n .el-step-footer{\r\n    text-align: center;\r\n}\r\n.dialog-footer{\r\n    text-align: center;\r\n}\r\n</style>\r\n"]}]}