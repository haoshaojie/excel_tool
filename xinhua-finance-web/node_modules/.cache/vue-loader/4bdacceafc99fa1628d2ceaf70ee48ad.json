{"remainingRequest":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\src\\views\\contract\\product\\group\\prodInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\src\\views\\contract\\product\\group\\prodInfo.vue","mtime":1618794737784},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport productDialog from \"./product-dialog\";\r\nimport priceDialog from \"./price-dialog\"\r\nexport default {\r\n  name:'product-info',\r\n  components:{productDialog, priceDialog},\r\n  props:{\r\n    isView:false,\r\n    prodInfo:{\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      dialogForm:{},\r\n      dialogPriceForm:{\r\n        prodName:'',\r\n        prodType:'',\r\n        prodId:'',\r\n        type:''\r\n      },\r\n      dialogOpen:{\r\n        prod:false,\r\n        price:false\r\n      }\r\n    }\r\n  },\r\n  mounted(){\r\n  },\r\n  methods:{\r\n    arraySpanMethod(){\r\n      var that = this;\r\n      setTimeout(function () {\r\n        if (that.$el.querySelector(\".el-table__footer-wrapper\")) {\r\n          var current = that.$el.querySelector(\".el-table__footer-wrapper\")\r\n            .querySelector(\".el-table__footer\");\r\n          var cells = current.rows[0].cells;\r\n          cells[0].colSpan = \"6\";\r\n          cells[1].colSpan = \"4\";\r\n        }\r\n      }, 50);\r\n    },\r\n    getSummaries(param){\r\n      const { columns, data } = param;\r\n      const sums = [];\r\n      columns.forEach((column, index) => {\r\n        if (index === 0) {\r\n          sums[index] = '总计';\r\n          return;\r\n        }\r\n        if(column.property == 'price'){\r\n          const values = data.map(item => Number(item['price']));\r\n          if (!values.every(value => isNaN(value))) {\r\n            sums[1] = values.reduce((prev, curr) => {\r\n              const value = Number(curr);\r\n              if (!isNaN(value)) {\r\n                return prev + curr;\r\n              } else {\r\n                return prev;\r\n              }\r\n            }, 0);\r\n          } else {\r\n            sums[index] = '';\r\n          }\r\n        }else{\r\n          sums[index] = '';\r\n          return;\r\n        }\r\n        \r\n      });\r\n      return sums;\r\n    },\r\n    openDialog(type, row, index){\r\n      if(type == 'price'){\r\n        this.dialogPriceForm.prodId = row.id;\r\n        this.dialogPriceForm.type = 1;\r\n        this.dialogPriceForm.index = index;\r\n      }\r\n      this.dialogOpen[type]=true\r\n    },\r\n    cancelDialog(type){\r\n      this.dialogOpen[type]=false\r\n    },\r\n    rmRow(index){\r\n      this.prodInfo.products.splice(index, 1);\r\n    },\r\n    addRow(data){\r\n      this.prodInfo.products.push(Object.assign(...data,{type:1}));\r\n      this.cancelDialog('prod');\r\n    },\r\n    addPrice(data){\r\n      let result=[];\r\n      this.prodInfo.products.forEach((item,index)=>{\r\n        if(index == this.dialogPriceForm.index){\r\n          item.price= data.standardPrice;\r\n          item.currency= data.currency;\r\n          item.currencyName= data.currencyName;\r\n        }\r\n        result.push(item);\r\n      })\r\n      this.prodInfo.products = result;\r\n      this.cancelDialog('price');\r\n    }\r\n  }\r\n}\r\n",{"version":3,"sources":["prodInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"prodInfo.vue","sourceRoot":"src/views/contract/product/group","sourcesContent":["<template>\r\n  <el-form ref=\"prodForm\" :model=\"prodInfo\" label-width=\"100px\" class=\"demo-form-inline\"  size=\"mini\">\r\n    <el-form-item label=\"产品信息\">\r\n      <el-button type=\"primary\" v-if=\"!isView\" size=\"small\" @click=\"openDialog('prod')\" class=\"add-btn\">添加产品信息</el-button>\r\n        <el-table border size=\"small\"\r\n          show-summary\r\n          :summary-method=\"getSummaries\"\r\n          :span-method=\"arraySpanMethod\"\r\n          :data=\"prodInfo.products\">\r\n          <el-table-column label=\"产品名称\" prop=\"prodName\" width=\"120\"></el-table-column>\r\n          <el-table-column label=\"产品编码\" prop=\"prodCode\" width=\"90\"></el-table-column>\r\n          <el-table-column label=\"所属部门\" prop=\"prodDeptName\"></el-table-column>\r\n          <el-table-column label=\"产品分类\" prop=\"prodTypeName\"></el-table-column>\r\n          <el-table-column label=\"发布范围\" prop=\"releaseScopeName\"></el-table-column>\r\n          <el-table-column label=\"产品来源\" prop=\"itemSourseName\" width=\"90\"></el-table-column>\r\n          <el-table-column label=\"标准价\"  prop=\"price\">\r\n            <template slot=\"header\" slot-scope=\"scope\">\r\n              <span><i class=\"table-tip\">*</i>标准价</span> \r\n            </template>\r\n            <template slot-scope=\"scope\">\r\n              <el-form-item :prop=\"'products.' + scope.$index +'.price'\"\r\n                :rules=\"[{ required: true, message: '请选择', trigger: 'blur' }]\">\r\n              <el-input type=\"number\"\r\n                disabled  size=\"mini\"\r\n              v-model=\"scope.row.price\" \r\n              @click.native=\"openDialog('price', scope.row, scope.$index)\"></el-input>\r\n              </el-form-item>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"促销价\" prop=\"promotionPrice\">\r\n            <template slot=\"header\" slot-scope=\"scope\">\r\n              <span><i class=\"table-tip\">*</i>促销价</span> \r\n            </template>\r\n            <template slot-scope=\"scope\">\r\n              <el-form-item :prop=\"'products.' + scope.$index +'.promotionPrice'\"\r\n                :rules=\"[ { required: true, message: '请输入', trigger: 'blur' }]\">\r\n                <el-input type=\"number\" v-model=\"scope.row.promotionPrice\"></el-input>\r\n              </el-form-item>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"币种\" prop=\"currencyName\"></el-table-column>\r\n          <el-table-column v-if=\"!isView\" label=\"操作\" fixed=\"right\" width=\"80\">\r\n            <template slot-scope=\"scope\">\r\n              <el-button icon=\"el-icon-circle-plus-outline\" type=\"text\" size=\"small\" @click=\"rmRow(scope.$index)\">删除</el-button>\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n    </el-form-item>\r\n    <productDialog dialogTitle=\"添加产品\" :dialogForm=\"dialogForm\" :prodDialog=\"dialogOpen.prod\" @result=\"addRow\" @cancel=\"cancelDialog('prod')\"></productDialog>\r\n    <priceDialog dialogTitle=\"选择价格\" :dialogForm=\"dialogPriceForm\" :dialogOpen=\"dialogOpen.price\" @result=\"addPrice\" @cancel=\"cancelDialog('price')\"></priceDialog>\r\n  </el-form>\r\n</template>\r\n<script>\r\nimport productDialog from \"./product-dialog\";\r\nimport priceDialog from \"./price-dialog\"\r\nexport default {\r\n  name:'product-info',\r\n  components:{productDialog, priceDialog},\r\n  props:{\r\n    isView:false,\r\n    prodInfo:{\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      dialogForm:{},\r\n      dialogPriceForm:{\r\n        prodName:'',\r\n        prodType:'',\r\n        prodId:'',\r\n        type:''\r\n      },\r\n      dialogOpen:{\r\n        prod:false,\r\n        price:false\r\n      }\r\n    }\r\n  },\r\n  mounted(){\r\n  },\r\n  methods:{\r\n    arraySpanMethod(){\r\n      var that = this;\r\n      setTimeout(function () {\r\n        if (that.$el.querySelector(\".el-table__footer-wrapper\")) {\r\n          var current = that.$el.querySelector(\".el-table__footer-wrapper\")\r\n            .querySelector(\".el-table__footer\");\r\n          var cells = current.rows[0].cells;\r\n          cells[0].colSpan = \"6\";\r\n          cells[1].colSpan = \"4\";\r\n        }\r\n      }, 50);\r\n    },\r\n    getSummaries(param){\r\n      const { columns, data } = param;\r\n      const sums = [];\r\n      columns.forEach((column, index) => {\r\n        if (index === 0) {\r\n          sums[index] = '总计';\r\n          return;\r\n        }\r\n        if(column.property == 'price'){\r\n          const values = data.map(item => Number(item['price']));\r\n          if (!values.every(value => isNaN(value))) {\r\n            sums[1] = values.reduce((prev, curr) => {\r\n              const value = Number(curr);\r\n              if (!isNaN(value)) {\r\n                return prev + curr;\r\n              } else {\r\n                return prev;\r\n              }\r\n            }, 0);\r\n          } else {\r\n            sums[index] = '';\r\n          }\r\n        }else{\r\n          sums[index] = '';\r\n          return;\r\n        }\r\n        \r\n      });\r\n      return sums;\r\n    },\r\n    openDialog(type, row, index){\r\n      if(type == 'price'){\r\n        this.dialogPriceForm.prodId = row.id;\r\n        this.dialogPriceForm.type = 1;\r\n        this.dialogPriceForm.index = index;\r\n      }\r\n      this.dialogOpen[type]=true\r\n    },\r\n    cancelDialog(type){\r\n      this.dialogOpen[type]=false\r\n    },\r\n    rmRow(index){\r\n      this.prodInfo.products.splice(index, 1);\r\n    },\r\n    addRow(data){\r\n      this.prodInfo.products.push(Object.assign(...data,{type:1}));\r\n      this.cancelDialog('prod');\r\n    },\r\n    addPrice(data){\r\n      let result=[];\r\n      this.prodInfo.products.forEach((item,index)=>{\r\n        if(index == this.dialogPriceForm.index){\r\n          item.price= data.standardPrice;\r\n          item.currency= data.currency;\r\n          item.currencyName= data.currencyName;\r\n        }\r\n        result.push(item);\r\n      })\r\n      this.prodInfo.products = result;\r\n      this.cancelDialog('price');\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.add-btn{\r\n  margin-bottom: 1rem;\r\n}\r\n.table-tip{\r\n  color: #F56C6C;\r\n  font-weight: normal;\r\n  vertical-align: middle;\r\n  margin-right: 2px;\r\n  font-size: 14px;\r\n}\r\n.normal-input{\r\n  margin-bottom: 18px;\r\n}\r\n</style>"]}]}