{"remainingRequest":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\src\\views\\contract\\product\\components\\profitInfo.vue?vue&type=style&index=0&id=a4884830&lang=scss&scoped=true&","dependencies":[{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\src\\views\\contract\\product\\components\\profitInfo.vue","mtime":1618794737782},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\东方通\\source\\b_zwj\\xinhua-finance-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n.table-item{\r\n  width: 40%;\r\n  display: inline-block;\r\n  margin-bottom: 13px;\r\n}\r\n",{"version":3,"sources":["profitInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8NA;AACA;AACA;AACA;AACA","file":"profitInfo.vue","sourceRoot":"src/views/contract/product/components","sourcesContent":["<template>\r\n  <el-form  ref=\"profitForm\" :rules=\"profitRules\" :model=\"profitInfo\" label-width=\"100px\" class=\"demo-form-inline\"  size=\"mini\">\r\n    <el-form-item label=\"产品来源\">\r\n      <el-col :span=\"12\">\r\n        <el-radio-group :disabled=\"isView\" v-model=\"profitInfo.itemSourse\" @change=\"itemSourseChange\">\r\n          <el-radio :label=\"1\" >自有产品</el-radio>\r\n          <el-radio :label=\"2\" >合作商产品</el-radio>\r\n        </el-radio-group>\r\n      </el-col>\r\n    </el-form-item>\r\n    <el-form-item label=\"合作商\" v-show=\"profitInfo.itemSourse==2\" prop='partnerId'>\r\n      <el-col :span=\"12\">\r\n        <el-select :disabled=\"isView\" style=\"width:100%\" v-model=\"profitInfo.partnerId\" placeholder=\"请选择合作商\">\r\n          <el-option v-for=\"(item,i) in pars\" :key=\"i\" :label=\"item.parName\" :value=\"item.id\"></el-option>\r\n        </el-select>\r\n      </el-col>\r\n    </el-form-item>\r\n    <el-form-item label=\"分润比例\" v-show=\"profitInfo.itemSourse==2\"  prop=\"shareResult\">\r\n      <el-col :span=\"12\">\r\n        <el-radio-group :disabled=\"isView\" v-model=\"profitInfo.shareType\" @change=\"shareTypeChange\">\r\n          <el-radio :label=\"1\" >固定比例</el-radio>\r\n          <el-radio :label=\"2\" >阶梯比例</el-radio>\r\n        </el-radio-group>\r\n        <template v-if=\"profitInfo.itemSourse==2 && profitInfo.shareType == 1\">\r\n          <el-input :disabled=\"isView\" placeholder=\"请输入分润比例\" type=\"number\" v-model=\"profitInfo.shareResult\">\r\n            <template slot=\"append\">%</template>\r\n          </el-input>\r\n          <el-link type=\"info\" :underline=\"false\">注：分润比例为合作商的分润比例</el-link>\r\n        </template>\r\n        <template v-if=\"profitInfo.itemSourse==2 && profitInfo.shareType == 2\">\r\n          <el-form :model=\"profitInfo\" :disabled=\"isView\" ref=\"ratesForm\" size=\"small\">\r\n          <el-table border size=\"small\"\r\n            :data=\"profitInfo.profitRates\"\r\n            style=\"width: 100%\">\r\n            <el-table-column label=\"人数范围\">\r\n              <template slot-scope=\"scope\">\r\n                <el-form-item \r\n                :prop=\"'profitRates.' + scope.$index + '.beginUserRcnt'\" \r\n                class=\"table-item\">\r\n                  <el-input  \r\n                  disabled\r\n                  v-model.number=\"scope.row.beginUserRcnt\" \r\n                  size=\"small\"\r\n                  ></el-input>\r\n                </el-form-item>\r\n                至\r\n                <el-form-item \r\n                :prop=\"'profitRates.' + scope.$index + '.endUserCnt'\" \r\n                :rules=\"[{required:true,validator:( rule, value, callback)=>{checkUserRcnt(scope.row,rule, value, callback)} ,trigger:'blur'}]\" \r\n                class=\"table-item\">\r\n                  <el-input @input=\"userRcntInput(scope.row.endUserCnt,scope.$index)\" v-model.number=\"scope.row.endUserCnt\" size=\"small\" placeholder=\"请输入\"></el-input>\r\n                </el-form-item>\r\n              </template>\r\n            </el-table-column>\r\n            <el-table-column label=\"比例（%）\" width=\"120\">\r\n              <template slot-scope=\"scope\">\r\n                <el-form-item \r\n                :prop=\"'profitRates.' + scope.$index + '.profirRate'\"\r\n                :rules=\"[{required:true,message:'请输入比例',trigger:'blur'},\r\n                {pattern:/^([1-9]\\d{0,1}|100)$/, message: '请输入1-100的正整数', trigger: 'blur'}]\">\r\n                  <el-input type=\"number\" :min=\"1\" :max=\"100\" v-model.number=\"scope.row.profirRate\" size=\"small\" placeholder=\"请输入\"></el-input>\r\n                </el-form-item>\r\n              </template>\r\n            </el-table-column>>\r\n            <el-table-column v-if=\"!isView\" label=\"操作\" fixed=\"right\" width=\"80\"  class=\"table-item\">\r\n              <template slot-scope=\"scope\">\r\n                  <el-button v-if=\"scope.$index == 0\" icon=\"el-icon-circle-plus-outline\" type=\"text\" size=\"small\" @click=\"profitInfoAddItem(scope.$index, scope.row)\">新增</el-button>\r\n                  <el-button v-if=\"scope.$index > 0\" icon=\"el-icon-delete\" type=\"text\" size=\"small\" style='color: #E02020;' @click=\"profitInfoRmItem(scope.$index, scope.row)\">删除</el-button>\r\n              </template>\r\n            </el-table-column>\r\n          </el-table>\r\n          </el-form>\r\n        </template>\r\n      </el-col>\r\n    </el-form-item>\r\n  </el-form>\r\n</template>\r\n<script>\r\nimport {profitRateByProdId} from \"@/api/contract/product/productitem\";\r\nimport {selectPartnerItems} from '@/api/partner/partner';\r\nexport default {\r\n  name:\"profitInfo\",\r\n  props:{\r\n    isView:false,\r\n    profitInfo:{\r\n      partnerId:'',\r\n      profitRates:[],\r\n      itemSourse: 1,\r\n      shareType: '',\r\n      shareResult:''\r\n    }\r\n  },\r\n  data(){\r\n      return {\r\n        productType:1,// 1产品类型；2产品项；3组成产品；\r\n        profitRules:{\r\n          partnerId:[\r\n            {required: true, validator:this.checkParId, trigger: 'change'}\r\n          ],\r\n          shareResult:[\r\n            {required: true, validator:this.checkShareResult, trigger: 'blur'}\r\n          ],\r\n          releaseScope:[\r\n            { required: true, message: '请输入发布范围', trigger: 'blur'}\r\n          ],\r\n          prodId:[\r\n            { required: true, message: '请输入发布应用', trigger: 'blur'}\r\n          ],\r\n        }\r\n      }\r\n  },\r\n  mounted(){\r\n   this.onLoad();\r\n  },\r\n  methods:{\r\n    showData(data){\r\n      this.profitInfo.itemSourse = data.itemSourse\r\n      if(data.itemSourse == 2){\r\n        this.profitInfo.partnerId = data.partnerId\r\n        this.profitInfo.shareType = data.shareType\r\n        this.profitInfo.shareResult = data.shareResult\r\n        if(data.shareType == 2){\r\n          profitRateByProdId(data.id, this.productType).then(res =>{\r\n            let data = res.data.data;\r\n            console.log(\"profit\",data)\r\n            this.profitInfo.profitRates= data\r\n          })\r\n        }\r\n        \r\n      }\r\n    },\r\n    itemSourseChange(value){\r\n        // 分润比例 1 自有产品 2 合作商产品\r\n      if (value == 1) {\r\n        this.profitInfo.partnerId='';\r\n        this.profitInfo.shareType = '';\r\n      }else if(value === 2){\r\n        this.profitInfo.shareType = 1;\r\n      }\r\n    },\r\n    shareTypeChange(value){\r\n      // 分润比例 1 固定 2 阶梯\r\n      if (value == 1) { \r\n        this.profitInfo.profitRates=[];\r\n      }else if(value == 2){\r\n        this.profitInfo.shareResult=\"\";\r\n        this.profitInfo.profitRates=[{beginUserRcnt:1,endUserCnt:'',profirRate:''}];\r\n      }\r\n    },\r\n    checkParId(rule, value, callback){\r\n      console.log(this.profitInfo.itemSourse, value)\r\n      if(this.profitInfo.itemSourse==2){\r\n        if(!this.profitInfo.partnerId){\r\n          callback(new Error(\"请选择合作商\"))\r\n        }else{\r\n          callback()\r\n        }\r\n      }else{\r\n        callback()\r\n      }\r\n    },\r\n   \r\n    checkShareResult(rule, value, callback){\r\n      if(this.profitInfo.itemSourse==2 && this.profitInfo.shareType == 1){\r\n        if(value == ''){\r\n          callback(new Error(\"请输入分润比例\"))\r\n        }else{\r\n          if(value>=1 && value <=100){\r\n            callback()\r\n          }else{\r\n            callback(new Error(\"分润比例应为1%至100%之间\"))\r\n          }\r\n        }\r\n      }else if(this.profitInfo.itemSourse==2 && this.profitInfo.shareType == 2){\r\n        console.log(\"校验表格内容\")\r\n        callback()\r\n      }else{\r\n        callback()\r\n      }\r\n    },\r\n    checkUserRcnt(row, rule, value, callback){\r\n      console.log(row)\r\n      if(!value){\r\n        callback(new Error(\"请输入\"))\r\n      }else if(value<=row.beginUserRcnt){\r\n          callback(new Error(\"请大于\"+row.beginUserRcnt))\r\n      }else{\r\n        callback()\r\n      }\r\n      \r\n    },\r\n    profitInfoAddItem(){\r\n      let beginUserRcnt='';\r\n      if(this.profitInfo.profitRates[this.profitInfo.profitRates.length-1]){\r\n        let row = this.profitInfo.profitRates[this.profitInfo.profitRates.length-1]\r\n        if(row.endUserCnt){\r\n          beginUserRcnt = parseInt(row.endUserCnt)+1\r\n        }\r\n      }\r\n      this.profitInfo.profitRates.push({beginUserRcnt:beginUserRcnt, endUserCnt:'',profirRate:''})\r\n    },\r\n    userRcntInput(value, index){\r\n      if(value){\r\n        value=(value+\"\").replace(/[^\\d]/g,'')\r\n        this.profitInfo.profitRates[index].endUserCnt=value\r\n        if(value && this.profitInfo.profitRates[index+1]){\r\n          this.profitInfo.profitRates[index+1].beginUserRcnt = parseInt(value) +1\r\n        }\r\n      }\r\n    },\r\n    profitInfoRmItem(index){\r\n      this.profitInfo.profitRates.splice(index, 1)\r\n    },\r\n    onLoad() {\r\n      selectPartnerItems().then(res => {\r\n        this.pars=res.data.data\r\n      });\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.table-item{\r\n  width: 40%;\r\n  display: inline-block;\r\n  margin-bottom: 13px;\r\n}\r\n</style>"]}]}