<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.cnfic.contractmanage.contract.mapper.ConUserProdMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="userProdResultMap" type="cn.com.cnfic.contractmanage.contract.entity.ConUserProd">
        <id column="id" property="id"/>
        <result column="create_time" property="createTime"/>
        <result column="create_user" property="createUser"/>
        <result column="update_time" property="updateTime"/>
        <result column="update_user" property="updateUser"/>
        <result column="is_deleted" property="isDeleted"/>
        <result column="con_prod_id" property="conProdId"/>
        <result column="con_id" property="conId"/>
        <result column="user_id" property="userId"/>
        <result column="account_id" property="accountId"/>
        <result column="propuct_type" property="propuctType"/>
        <result column="prod_id" property="prodId"/>
        <result column="start_time" property="startTime"/>
        <result column="end_time" property="endTime"/>
    </resultMap>

    <resultMap id="userProdVoResultMap" extends="userProdResultMap" type="cn.com.cnfic.contractmanage.contract.vo.ConUserProdVO">
        <result column="con_no" property="conNo"/>
        <result column="con_name" property="conName"/>
        <result column="user_name" property="userName"/>
        <result column="cust_org" property="deptName"/>
    </resultMap>
    <select id="selectUserProdPage" resultMap="userProdVoResultMap">
        select  a1.con_id,a1.user_id,c.con_no,c.con_name,u.user_name,u.cust_org  from (select con_id,user_id from  (select  con_id,user_id from con_user_prod where is_deleted = 0 ORDER BY create_time desc,id asc )a  GROUP BY con_id,user_id
        )a1
        left join con_contract c on a1.con_id =c.id and c.is_deleted=0
        left join sub_org_user u on a1.user_id=u.id and u.is_deleted=0
    </select>

</mapper>
